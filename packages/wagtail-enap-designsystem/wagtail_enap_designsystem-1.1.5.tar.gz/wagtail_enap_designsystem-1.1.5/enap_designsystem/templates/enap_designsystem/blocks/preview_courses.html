
{% load wagtailcore_tags wagtailimages_tags %}

{% block block_render %}
{% load static %}

<section class="section-courses">
    <div class="content-section">
        <div class="section-header">
            <h2 class="section-heading">{{ value.page.title }}</h2>
            <h4 class="section-subheading">Conheça nossas especializações</h4>
        </div>
    
        <div class="slider-container">
            <div class="container-preview"><div class="slider-track">
                {% with page_instance=value.page.specific %}
                    {% for course in page_instance.get_children.live %}
                        <div class="slider-item">
                            {% with course_specific=course.specific %}
                                <!-- Extrair a primeira imagem de banner disponível -->
                                {% for block in course_specific.content %}
                                    {% if block.block_type == 'banner' and block.value.background_image %}
                                        {% image block.value.background_image fill-510x400 as banner_img %}
                                        <div class="card-bgimage" style="background-image: url('{{ banner_img.url }}');">
                                            <div class="wrapper-text-card-bgimage">
                                                <div class="wrapper-text-card">
                                                    <h2 class="h2-card">{{ course.title }}</h2>
                                                    <p class="p-card">{{ block.value.description|richtext|striptags|truncatechars:100 }}</p>
                                                </div>
                                                <div class="wrapper-button">
                                                    <a href="{% pageurl course %}" class="btn-card">Saiba mais <i class="fa-solid fa-circle-chevron-right"></i></a>
                                                </div>
                                            </div>
                                        </div>
                                    
                                    {% endif %}
                                {% endfor %}
                            {% endwith %}
                        </div>
                    {% empty %}
                        <div class="slider-item">
                            <p>Nenhuma especialização disponível.</p>
                        </div>
                    {% endfor %}
                {% endwith %}
            </div></div>
            <button class="slider-arrow slider-arrow-prev"><img style="width: 40px; height: 40px;" src="{% static 'enap_designsystem/icons/iconleft.svg' %}" alt="Anterior"></button>
            <button class="slider-arrow slider-arrow-next"><img style="width: 40px; height: 40px;" src="{% static 'enap_designsystem/icons/iconrig.svg' %}" alt="Próximo"></button>
        </div>

        
    </div>
    
</section>

<style>
    body {
        font-family: "Georama", serif;
    }

    .section-courses{
        background-color: #EBEFF5;
        padding: 90px 0;
    }
    
    .section-header {
        display: flex;
        flex-direction: column;
        padding: 0 2rem;
        gap: 10px;
        margin-bottom: 40px;
        max-width: 1142px;
    }

    .container-preview{
        max-width: 1142px;
        overflow: hidden;
        margin: auto;
        padding: 0 2rem;
    }

    .view-all-button{
        display: flex;
        align-items: center;
        justify-content: center;
        height: 40px;
        text-decoration: none;
        color: #007D7A;
        border: 1px solid #007D7A;
        padding: 8px 24px;
        border-radius: 40px;
        background-color: white;
        font-weight: 600;
    }
    .view-all-button:hover{
        color: #006969;
        border: 1px solid #006969;
    }

    .view-all-button:active{
        color: #025257;
        border: 1px solid #025257;
    }

    .section-subheading {
        font-size: 20px;
        font-weight: 400;
        margin: 0;
        color: #333840;
    }

    .section-heading {
        margin: 0;
        font-size: 40px;
        font-weight: 600;
        color: #024248;
        text-align: left;
    }

    .content-section {
        display: flex;
        flex-direction: column;
        gap: 40px;
        max-width: 74.1rem;
        margin: auto;
        padding: 60px 2rem;
    }

    .slider-container {
        position: relative;
        width: 71.1rem;
        margin: auto;
        touch-action: pan-y;
    }

    .slider-track {
        width: 1142px;
        margin: auto;
        display: flex;
        transition: transform 0.5s ease-in-out;
        -webkit-overflow-scrolling: touch;
    }

    .slider-item {
        flex-shrink: 0;
        width: 510px;
        margin-right: 20px;
    }

    /* Card Styles */
    .card-bgimage {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        border-radius: 20px;
        padding: 16px;
        display: flex;
        align-items: end;
        overflow: hidden;
        max-width: 100%;
        height: 360px;
    }
    
    .wrapper-text-card-bgimage {
        background-color: white;
        padding: 16px;
        border-radius: 12px;
        width: 100%;
    }
    
    .wrapper-text-card {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 8px;
        align-items: flex-start;
    }
    
    .h2-card {
        font-size: 18px;
        font-weight: 600;
        color: #434A54;
        margin: 0;
    }
    
    .p-card {
        font-size: 16px;
        color: #434A54;
        margin: 0;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    
    .wrapper-button {
        display: flex;
        justify-content: right;
        gap: 8px;
        margin-top: 8px;
    }
    
    .btn-card {
        background-color: white;
        color: #007D7A;
        border: none;
        cursor: pointer;
        font-weight: 500;
        text-decoration: none;
        display: inline-block;
        transition: background-color 0.3s;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-card:hover {
        color: #006969;
    }

    .slider-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 30px;
        color: #333;
        cursor: pointer;
        border: none;
        background-color: transparent;
        z-index: 2;
    }

    .slider-arrow-prev {
        left: -7px;
    }

    .slider-arrow-next {
        right: -6px;
        padding: 0;
    }

    /* Ajustes para mobile */
    @media (max-width: 768px) {

        .section-courses{
            padding: 60px 0;
        }

        .section-header {
            padding: 0;
            gap: 0;
            margin-bottom: 0px;
        }

        .container-preview{
            padding: 0;
        }

        .slider-track {
            width: auto;
            overflow: visible;
            margin: 0;
        }
        .section-heading {
            font-size: 32px;
        }
        
        .section-subheading {
            font-size: 20px;
            text-align: left;
            margin-top: 10px;
        }
        
        .content-section {
            padding: 0px 0 0 15px;
        }
        
        .slider-container {
            width: 100%;
        }
        
        .slider-item {
            width: 75vw;
            padding-right: 0;
        }
        
        body .slider-arrow {
            display: none !important;
        }
        
        .slider-arrow img {
            width: 100%;
            height: auto;
        }
        
        /* Indica visualmente que há mais conteúdo */
        .slider-container::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 30px;
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0), rgba(255,255,255,0.8));
            pointer-events: none;
            z-index: 1;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const sliderContainer = document.querySelector('.slider-container');
        const sliderTrack = document.querySelector('.slider-track');
        const prevButton = document.querySelector('.slider-arrow-prev');
        const nextButton = document.querySelector('.slider-arrow-next');
        let currentIndex = 0;
        
        // Obtém o número total de itens no carrossel
        const totalItems = sliderTrack.children.length;
        let maxIndex = Math.max(0, totalItems - 1);
        
        // Variáveis para controle de touch
        let touchStartX = 0;
        let touchEndX = 0;
        let isDragging = false;
        let startTranslateX = 0;
        let currentTranslateX = 0;
        let slideWidth = 0;
        let slideMargin = 20;
        let isMobile = false;
        
        function updateSlideWidth() {
            isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // Em mobile, definimos uma largura exata para os slides (75% da viewport)
                slideWidth = Math.floor(window.innerWidth * 0.75);
            } else {
                // Para desktop, usamos a largura exata do item conforme definido no CSS (510px)
                slideWidth = 510;
            }
            
            // Atualiza a largura dos itens no DOM para garantir consistência
            Array.from(sliderTrack.children).forEach(item => {
                item.style.width = `${slideWidth}px`;
                item.style.marginRight = `${slideMargin}px`;
            });
            
            // Garante que o índice atual esteja dentro dos limites válidos após redimensionamento
            currentIndex = Math.min(currentIndex, maxIndex);
            
            // Reposiciona o carousel na posição atual
            showSlide(currentIndex);
        }
        
        // Função para atualizar a visibilidade dos botões de navegação
        function updateNavigationButtons() {
            // No primeiro slide, esconde o botão de voltar
            if (currentIndex === 0) {
                prevButton.style.display = 'none';
            } else {
                prevButton.style.display = 'block';
            }
            
            // No último slide, esconde o botão de avançar
            if (currentIndex >= maxIndex) {
                nextButton.style.display = 'none';
            } else {
                nextButton.style.display = 'block';
            }
        }
        
        function showSlide(index) {
            // Garante que o índice esteja dentro dos limites
            currentIndex = Math.min(Math.max(0, index), maxIndex);
            
            // Calcula o deslocamento exato baseado na largura + margem dos slides
            const offset = currentIndex * (slideWidth + slideMargin);
            sliderTrack.style.transform = `translateX(-${offset}px)`;
            
            // Atualizar a visibilidade dos botões de navegação
            updateNavigationButtons();
        }
        
        // Inicializar a visibilidade dos botões
        updateNavigationButtons();
        
        // Para navegação por botões (desktop)
        prevButton.addEventListener('click', function() {
            if (currentIndex > 0) {
                showSlide(currentIndex - 1);
            }
        });
        
        nextButton.addEventListener('click', function() {
            if (currentIndex < maxIndex) {
                showSlide(currentIndex + 1);
            }
        });
        
        // Funções para controle de touch em dispositivos móveis
        function handleTouchStart(event) {
            touchStartX = event.touches[0].clientX;
            isDragging = true;
            startTranslateX = -currentIndex * (slideWidth + slideMargin);
            currentTranslateX = startTranslateX;
            
            sliderTrack.style.transition = 'none';
        }
        
        function handleTouchMove(event) {
            if (!isDragging) return;
            touchEndX = event.touches[0].clientX;
            const diffX = touchEndX - touchStartX;
            
            // Limitar o arrasto para não ultrapassar os limites
            currentTranslateX = Math.min(0, Math.max(-(maxIndex * (slideWidth + slideMargin)), startTranslateX + diffX));
            sliderTrack.style.transform = `translateX(${currentTranslateX}px)`;
            
            // Prevenir scroll da página durante o swipe horizontal
            if (Math.abs(diffX) > 5) {
                event.preventDefault();
            }
        }
        
        function handleTouchEnd() {
            if (!isDragging) return;
            isDragging = false;
            sliderTrack.style.transition = 'transform 0.5s ease-in-out';
            
            const diffX = touchEndX - touchStartX;
            const threshold = slideWidth * 0.2; // 20% da largura do slide como threshold
            
            if (Math.abs(diffX) > threshold) {
                if (diffX > 0 && currentIndex > 0) {
                    // Swipe para direita (anterior)
                    currentIndex--;
                } else if (diffX < 0 && currentIndex < maxIndex) {
                    // Swipe para esquerda (próximo)
                    currentIndex++;
                }
            }
            
            // Garante que o carrossel se alinhe perfeitamente após o swipe
            showSlide(currentIndex);
        }
        
        // Adiciona listeners para eventos de touch
        sliderContainer.addEventListener('touchstart', handleTouchStart, { passive: false });
        sliderContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
        sliderContainer.addEventListener('touchend', handleTouchEnd);
        
        // Atualiza larguras e posições ao redimensionar a janela
        window.addEventListener('resize', updateSlideWidth);
        
        // Inicialização
        updateSlideWidth();
    });
</script>
{% endblock %}