(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[316],{16443:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>h});var a=r(95155),n=r(12115),c=r(5777),l=r.n(c),t=r(37123);function i(e){let{runData:s,onStatusChange:r}=e,[c,i]=(0,n.useState)(s.scanning_status),[d,o]=(0,n.useState)(!1),u="paused"===c.toLowerCase(),h=async()=>{if(!d){o(!0);try{let e=u?t.Q.runs.resume(s.scan_id):t.Q.runs.pause(s.scan_id);if(!(await fetch(e,{method:"POST"})).ok)throw Error("Failed to ".concat(u?"resume":"pause"," scan"));i(u?"Running":"Paused"),r&&r()}catch(e){console.error("Error toggling scan status:",e)}finally{o(!1)}}};return(0,a.jsxs)("div",{className:l().progressCard,children:[(0,a.jsxs)("div",{className:l().progressCardContent,children:[(0,a.jsxs)("div",{className:l().progressCardColumn,children:[(0,a.jsxs)("div",{className:l().progressCardField,children:[(0,a.jsx)("div",{className:l().progressCardLabel,children:"Scan name:"}),(0,a.jsx)("div",{className:l().progressCardValue,children:s.scan_name})]}),(0,a.jsxs)("div",{className:l().progressCardField,children:[(0,a.jsx)("div",{className:l().progressCardLabel,children:"Scanning Percentage:"}),(0,a.jsxs)("div",{className:l().progressCardValue,children:[s.scan_percentage,"%"]})]})]}),(0,a.jsxs)("div",{className:l().progressCardColumn,children:[(0,a.jsxs)("div",{className:l().progressCardField,children:[(0,a.jsx)("div",{className:l().progressCardLabel,children:"Model name:"}),(0,a.jsx)("div",{className:l().progressCardValue,children:s.model_name})]}),(0,a.jsxs)("div",{className:l().progressCardField,children:[(0,a.jsx)("div",{className:l().progressCardLabel,children:"Scanning Progress:"}),(0,a.jsxs)("div",{className:l().progressCardValue,children:[s.passed_line,"/",s.total_length||"?"]})]})]}),(0,a.jsxs)("div",{className:l().progressCardColumn,children:[(0,a.jsxs)("div",{className:l().progressCardField,children:[(0,a.jsx)("div",{className:l().progressCardLabel,children:"Starting at:"}),(0,a.jsx)("div",{className:l().progressCardValue,children:s.scan_time})]}),(0,a.jsxs)("div",{className:l().progressCardField,children:[(0,a.jsx)("div",{className:l().progressCardLabel,children:"Time remaining:"}),(0,a.jsx)("div",{className:l().progressCardValue,children:s.remaining_time})]})]}),(0,a.jsx)("button",{className:"".concat(l().progressCardPlayButton," ").concat(u?l().pauseButton:""),onClick:h,disabled:d,"aria-label":u?"Resume scan":"Pause scan",children:(0,a.jsx)("div",{className:l().playIcon,children:u?"▶":"❚❚"})})]}),(0,a.jsx)("div",{className:l().progressBarContainer,children:(0,a.jsx)("div",{className:l().progressBarFill,style:{width:"".concat(s.scan_percentage,"%")}})})]})}var d=r(38561),o=r(78772),u=r(48263);function h(){let[e,s]=(0,n.useState)([]),[r,c]=(0,n.useState)(!0),[h,m]=(0,n.useState)(null),[g,p]=(0,n.useState)(0),[v,j]=(0,n.useState)(!1),x=(0,n.useRef)(5e3),C=(0,n.useRef)(""),N=(0,n.useRef)(null),f=(0,n.useRef)(!0),_=(0,n.useRef)(null),b=(0,n.useRef)(!0),y=(0,n.useRef)(!0),S=(0,n.useCallback)(async()=>{if(!b.current||!y.current)return;N.current&&N.current.abort();let e=new AbortController;N.current=e;let r=e.signal;try{c(!0);let e=await fetch(t.Q.runs.progress,{signal:r});if(!b.current)return;if(!e.ok)throw Error("Failed to fetch active runs");let a=await e.json(),n=a.map(e=>({scan_id:e.scan_id,scan_percentage:e.scan_percentage,passed_line:e.passed_line,scanning_status:e.scanning_status})),l=JSON.stringify(n);f.current?f.current=!1:l===C.current?x.current=Math.min(1.5*x.current,2e4):x.current=5e3,console.log("polling interval",x.current),C.current=l,s(a),m(null)}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;console.error("Error fetching active runs:",e),m(e instanceof Error?e.message:"An error occurred")}finally{N.current===e&&b.current&&(N.current=null,c(!1)),b.current&&y.current&&(_.current=setTimeout(()=>{S()},x.current))}},[]),E=(0,n.useCallback)(()=>{_.current&&clearTimeout(_.current),y.current=!0,S()},[S]),w=(0,n.useCallback)(()=>{y.current=!1,_.current&&(clearTimeout(_.current),_.current=null),N.current&&(N.current.abort(),N.current=null)},[]);(0,n.useEffect)(()=>{b.current=!0,E();let e=()=>{document.hidden?w():E()};return document.addEventListener("visibilitychange",e),()=>{b.current=!1,w(),document.removeEventListener("visibilitychange",e)}},[E,w]),(0,n.useEffect)(()=>{g>0&&(x.current=5e3,w(),E())},[g,E,w]),(0,n.useEffect)(()=>{v?w():E()},[v,E,w]);let k=()=>{x.current=5e3,p(e=>e+1)},R=async e=>{j(!1),e&&setTimeout(async()=>{x.current=5e3,E()},1e3)};return r&&0===e.length?(0,a.jsx)("div",{className:l().loading,children:(0,a.jsx)(u.y,{})}):(0===e.length&&(console.log(" found activeRuns.length === 0"),w()),(0,a.jsxs)("div",{className:l().container,children:[(0,a.jsxs)("div",{className:l().pageHeader,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:l().title,children:"Progress"}),(0,a.jsx)("div",{className:l().subtitle,children:"Watch the scanning progress"})]}),(0,a.jsx)("div",{className:l().actions,children:(0,a.jsx)(d.T,{radius:"full",variant:"bordered",color:"primary",onPress:()=>j(!0),className:l().buttonColorSolid,children:"New Scan"})})]}),h?(0,a.jsx)("div",{className:l().error,children:h}):(0,a.jsx)("div",{className:l().progressCardContainer,children:e.length>0?e.map(e=>(0,a.jsx)(i,{runData:e,onStatusChange:k},e.scan_id)):(0,a.jsx)("div",{className:l().progressCard,children:(0,a.jsx)("div",{className:l().progressCardContent,children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{children:"No Active Scans"}),(0,a.jsx)("p",{children:"There are no scans currently in progress."})]})})})}),(0,a.jsx)(o.D,{isOpen:v,onClose:e=>R(e)})]}))}},67265:(e,s,r)=>{Promise.resolve().then(r.bind(r,16443))}},e=>{var s=s=>e(e.s=s);e.O(0,[718,512,766,817,508,904,441,684,358],()=>s(67265)),_N_E=e.O()}]);