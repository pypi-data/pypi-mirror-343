var Gt=Object.defineProperty;var Vt=(a,t,e)=>t in a?Gt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var k=(a,t,e)=>Vt(a,typeof t!="symbol"?t+"":t,e);import{j as Pt,k as Ut,m as Rt,n as Wt,o as qt,C as et,p as ht,q as Ot,s as Bt}from"../chunks/BFcSvz-c.mjs";import{aA as Kt,aB as Nt,aC as xt,T as at,aD as Yt,aE as Jt,aF as Qt,aG as Xt,aH as Zt,aI as te,aJ as ee,aK as ae,aL as le,aM as se,aN as oe,aO as re,aP as ie,aQ as ne,aR as ue,aS as de,aT as ce,aU as Tt,aV as pe,aW as me,aX as ve,aY as ge,aZ as fe,a_ as $e,a$ as he,b0 as be,b1 as ye,b2 as _e,J as wt}from"../chunks/BiKpa2f-.mjs";import{w as mt,r as St}from"../chunks/DqGH9kBy.mjs";import{c as ot}from"../chunks/C0VzVgoS.mjs";import{i as pt,S as ke}from"../chunks/q9maetcp.mjs";import"../chunks/Bg9kRutz.mjs";import{i as Q}from"../chunks/nnh_QitT.mjs";import{p as X,l as yt,a as jt,f as R,t as W,b as A,c as p,g as u,d as Z,i as x,n as q,r as S,V as M,m as Y,s as J,T as _t,K as C,e as kt,al as E,h as rt}from"../chunks/DV-2yDg-.mjs";import{p as D,i as Ct}from"../chunks/x5bsbXB-.mjs";import{R as ut,e as vt,i as gt}from"../chunks/BcMgA1Yz.mjs";import{I as Ce}from"../chunks/CmSobwbP.mjs";import{a as Ne}from"../chunks/9wizx-8k.mjs";import{s as dt,d as B,a as F,b as At,m as zt}from"../chunks/DDtyVqW1.mjs";import{T as It}from"../chunks/C3rarh8G.mjs";import{s as z}from"../chunks/C_re1EiV.mjs";import{C as ft}from"../chunks/D7_czLJ9.mjs";import{H as L,a as Ft}from"../chunks/BbA1NO4v.mjs";import{E as nt,a as K,S as Ie,C as Pe,R as Oe}from"../chunks/rh8WnBH3.mjs";import{W as Te}from"../chunks/CB0B2BdO.mjs";import{T as we}from"../chunks/C5iqJ45g.mjs";function Mt(){}function tt(a){return a.notetype.case==="globalNotetype"?a.notetype.value:null}function bt(a){return a.deck.case==="deckId"?a.deck.value:null}class Se{constructor(t,e,l,s){k(this,"path");k(this,"deckNameIds");k(this,"notetypeNameIds");k(this,"defaultDelimiter");k(this,"defaultIsHtml");k(this,"defaultNotetypeId");k(this,"defaultDeckId");k(this,"metadata");k(this,"globalNotetype");k(this,"deckId");k(this,"fieldNames");k(this,"columnOptions");k(this,"lastMetadata");k(this,"lastGlobalNotetype");k(this,"lastDeckId");k(this,"fieldNamesSetter",Mt);k(this,"columnOptionsSetter",Mt);var i;this.path=t,this.deckNameIds=l.entries,this.notetypeNameIds=e.entries,this.lastMetadata=ot(s),this.metadata=mt(s),this.metadata.subscribe(this.onMetadataChanged.bind(this));const o=tt(s);this.lastGlobalNotetype=ot(tt(s)),this.globalNotetype=mt(ot(o)),this.globalNotetype.subscribe(this.onGlobalNotetypeChanged.bind(this)),this.lastDeckId=bt(s),this.deckId=mt(bt(s)),this.deckId.subscribe(this.onDeckIdChanged.bind(this)),this.fieldNames=St(o===null?Promise.resolve([]):Pt({ntid:o.id}).then(r=>r.vals),r=>{this.fieldNamesSetter=r}),this.columnOptions=St(Dt(s),r=>{this.columnOptionsSetter=r}),this.defaultDelimiter=s.delimiter,this.defaultIsHtml=s.isHtml,this.defaultNotetypeId=((i=this.lastGlobalNotetype)==null?void 0:i.id)||null,this.defaultDeckId=this.lastDeckId}doImport(){return Ut({path:this.path,metadata:{...this.lastMetadata,preview:[]}},{alertOnError:!1})}async onMetadataChanged(t){var s,o,i;if(pt(t,this.lastMetadata))return;const e=this.shouldRefetchMetadata(t);if(e){const{globalTags:r,updatedTags:v}=t;t=await Rt({path:this.path,delimiter:t.delimiter,notetypeId:(s=tt(t))==null?void 0:s.id,deckId:(o=bt(t))!=null?o:void 0,isHtml:t.isHtml}),t.globalTags=r,t.updatedTags=v}const l=tt(t);this.globalNotetype.set(l),l!==null&&l.id!==((i=tt(this.lastMetadata))==null?void 0:i.id)&&this.fieldNamesSetter(Pt({ntid:l.id}).then(r=>r.vals)),this.shouldRebuildColumnOptions(t)&&this.columnOptionsSetter(Dt(t)),this.lastMetadata=ot(t),e&&this.metadata.set(t)}shouldRefetchMetadata(t){var e,l;return t.delimiter!==this.lastMetadata.delimiter||t.isHtml!==this.lastMetadata.isHtml||((e=tt(t))==null?void 0:e.id)!==((l=tt(this.lastMetadata))==null?void 0:l.id)}shouldRebuildColumnOptions(t){return!pt(t.columnLabels,this.lastMetadata.columnLabels)||!pt(t.preview[0],this.lastMetadata.preview[0])}onGlobalNotetypeChanged(t){pt(t,this.lastGlobalNotetype)||(this.lastGlobalNotetype=ot(t),t!==null&&this.metadata.update(e=>(e.notetype.value=t,e)))}onDeckIdChanged(t){t!==this.lastDeckId&&(this.lastDeckId=t,t!==null&&this.metadata.update(e=>(e.deck.value=t,e)))}}function Dt(a){const t=De(a),e=Me(a);return[{label:Kt(),value:0,disabled:!1}].concat(a.columnLabels.map((l,s)=>(s+=1,s===t?it(Nt(),!0,s):s===e?it(xt(),!0,s):s===a.guidColumn?it("GUID",!0,s):l===""?it(a.preview[0].vals[s-1],!1,s,!0):it(l,!1,s))))}function it(a,t,e,l){return{label:a?`${e}: ${a}`:e.toString(),shortLabel:l?e.toString():void 0,value:e,disabled:t}}function Me(a){return a.deck.case==="deckColumn"?a.deck.value:null}function De(a){return a.notetype.case==="notetypeColumn"?a.notetype.value:null}const He=async({params:a})=>{const[t,e,l]=await Promise.all([Wt({}),qt({skipEmptyDefault:!1,includeFiltered:!1}),Rt({path:a.path},{alertOnError:!1})]);return{state:new Se(a.path,t,e,l)}},_a=Object.freeze(Object.defineProperty({__proto__:null,load:He},Symbol.toStringTag,{value:"Module"}));var Ee=x('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Re=x('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Ht(a,t){X(t,!1);const e=Y();let l=D(t,"label",8),s=D(t,"columnOptions",8),o=D(t,"value",12);yt(()=>(_t(s()),_t(o())),()=>{var v;J(e,(v=s().find(m=>m.value===o()))==null?void 0:v.label)}),jt(),Q();var i=Re(),r=R(i);at(r,()=>({"--cols":2})),ut(r.lastChild,{children:(v,m)=>{var n=Ee(),I=R(n);at(I,()=>({"--col-size":1})),ft(I.lastChild,{children:(b,g)=>{q();var c=W();A(()=>z(c,l())),p(b,c)},$$slots:{default:!0}}),S(I);var h=M(I,2);at(h,()=>({"--col-size":1})),ft(h.lastChild,{children:(b,g)=>{ke(b,{get label(){return u(e)},get list(){return s()},parser:c=>({content:c.label,value:c.value,disabled:c.disabled}),get value(){return o()},set value(c){o(c)},$$legacy:!0})},$$slots:{default:!0}}),S(h),p(v,n)},$$slots:{default:!0}}),S(r),p(a,i),Z()}var xe=x("<!> <!>",1);function je(a,t){X(t,!1);const e=dt(),l=()=>F(m,"$globalNotetype",e),s=()=>F(n,"$fieldNamesPromise",e),o=()=>F(I,"$columnOptions",e),i=()=>F(v,"$metadata",e);let r=D(t,"state",8);const v=r().metadata,m=r().globalNotetype,n=r().fieldNames,I=r().columnOptions;Q();var h=E(()=>Yt());It(a,{get title(){return u(h)},children:(b,g)=>{var c=xe(),P=R(c);{var O=y=>{var N=kt(),H=R(N);Ne(H,s,null,(_,G)=>{var j=kt(),lt=R(j);vt(lt,1,()=>u(G),gt,(ct,$t,d)=>{var V=E(()=>d===0?o().slice(1):o());Ht(ct,{get label(){return u($t)},get columnOptions(){return u(V)},get value(){return l().fieldColumns[d]},set value($){B(m,C(l).fieldColumns[d]=$,C(l))},$$legacy:!0})}),p(_,j)}),p(y,N)};Ct(P,y=>{l()!==null&&y(O)})}var T=M(P,2),f=E(()=>Jt());Ht(T,{get label(){return u(f)},get columnOptions(){return o()},get value(){return i().tagsColumn},set value(y){B(v,C(i).tagsColumn=y,C(i))},$$legacy:!0}),p(b,c)},$$slots:{default:!0}}),Z()}function Ae(){return[{label:Qt(),value:et.TAB},{label:Xt(),value:et.PIPE},{label:Zt(),value:et.SEMICOLON},{label:te(),value:et.COLON},{label:ee(),value:et.COMMA},{label:ae(),value:et.SPACE}]}function ze(){return[{label:le(),value:ht.UPDATE},{label:se(),value:ht.PRESERVE},{label:oe(),value:ht.DUPLICATE}]}function Fe(){return[{label:Nt(),value:Ot.NOTETYPE},{label:re(),value:Ot.NOTETYPE_AND_DECK}]}var Le=x('<th class="svelte-ezvffl"> </th>'),Ge=x('<td class="svelte-ezvffl"> </td>'),Ve=x('<tr class="svelte-ezvffl"></tr>'),Ue=x('<div class="outer svelte-ezvffl"><table class="preview svelte-ezvffl"><thead><tr class="svelte-ezvffl"></tr></thead><tbody></tbody></table></div> <!>',1);function We(a,t){X(t,!1);const e=dt(),l=()=>F(v,"$metadata",e),s=()=>F(m,"$columnOptions",e),o=Y();let i=D(t,"state",8),r=D(t,"maxColumns",8,1e3);const v=i().metadata,m=i().columnOptions;let n=Y(),I=Y(!1);function h(y){let N=!1;return{rows:y.map(_=>_.vals.length>r()?(N=!0,_.vals.slice(0,r())):_.vals),truncated:N}}yt(()=>(u(n),u(I),l()),()=>{(y=>(J(n,y.rows),J(I,y.truncated)))(h(l().preview))}),yt(()=>(u(I),_t(r())),()=>{J(o,u(I)?ie({count:r()}):"")}),jt(),Q();var b=Ue(),g=R(b),c=rt(g),P=rt(c),O=rt(P);vt(O,5,()=>s().slice(1),gt,(y,N)=>{let H=()=>u(N).label,_=()=>u(N).shortLabel;var G=Le(),j=rt(G,!0);S(G),A(()=>z(j,_()||H())),p(y,G)}),S(O),S(P);var T=M(P);vt(T,5,()=>u(n),gt,(y,N)=>{var H=Ve();vt(H,5,()=>u(N),gt,(_,G)=>{var j=Ge(),lt=rt(j,!0);S(j),A(()=>z(lt,u(G))),p(_,j)}),S(H),p(y,H)}),S(T),S(c),S(g);var f=M(g,2);Te(f,{get warning(){return u(o)}}),p(a,b),Z()}var qe=x("<!> <!> <!>",1);function Be(a,t){X(t,!1);const e=dt(),l=()=>F(o,"$metadata",e);let s=D(t,"state",8);const o=s().metadata,i={delimiter:{title:ne(),help:ue(),url:L.TextImporting.root},isHtml:{title:de(),help:ce(),url:L.TextImporting.html}},r=Object.values(i);let v=Y(),m=Y();function n(h){u(v).show(),u(m).to(h)}Q();var I=E(()=>Tt());It(a,{get title(){return u(I)},children:(h,b)=>{var g=qe(),c=R(g),P=E(Ae);nt(c,{get defaultValue(){return s().defaultDelimiter},get choices(){return u(P)},get disabled(){return l().forceDelimiter},get value(){return l().delimiter},set value(f){B(o,C(l).delimiter=f,C(l))},children:(f,y)=>{K(f,{$$events:{click:()=>n(Object.keys(i).indexOf("delimiter"))},children:(N,H)=>{q();var _=W();A(()=>z(_,i.delimiter.title)),p(N,_)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var O=M(c,2);Ie(O,{get defaultValue(){return s().defaultIsHtml},get disabled(){return l().forceIsHtml},get value(){return l().isHtml},set value(f){B(o,C(l).isHtml=f,C(l))},children:(f,y)=>{K(f,{$$events:{click:()=>n(Object.keys(i).indexOf("isHtml"))},children:(N,H)=>{q();var _=W();A(()=>z(_,i.isHtml.title)),p(N,_)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var T=M(O,2);We(T,{get state(){return s()}}),p(h,g)},$$slots:{default:!0,tooltip:(h,b)=>{var g=E(()=>Tt());Ft(h,{get title(){return u(g)},get url(){return L.TextImporting.root},slot:"tooltip",helpSections:r,$$events:{mount:c=>{J(v,c.detail.modal),J(m,c.detail.carousel)}}})}}}),Z()}var Ke=x('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Ye=x('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Et(a,t){X(t,!1);const e=dt(),l=()=>F(r,"$tagsWritable",e);let s=D(t,"tags",12),o=D(t,"keyCombination",8,void 0),i=D(t,"breakpoint",8,"md");const r=mt(s());Q();var v=Ye(),m=R(v);at(m,()=>({"--cols":13})),ut(m.lastChild,{children:(n,I)=>{var h=Ke(),b=R(h);at(b,()=>({"--col-size":7})),ft(b.lastChild,{get breakpoint(){return i()},children:(c,P)=>{var O=kt(),T=R(O);Bt(T,t,"default",{}),p(c,O)},$$slots:{default:!0}}),S(b);var g=M(b,2);at(g,()=>({"--col-size":6})),ft(g.lastChild,{get breakpoint(){return i()},children:(c,P)=>{Pe(c,{children:(O,T)=>{we(O,{tags:r,get keyCombination(){return o()},$$events:{tagsupdate:({detail:f})=>s(f.tags)}})},$$slots:{default:!0,revert:(O,T)=>{Oe(O,{slot:"revert",defaultValue:[],get value(){return zt(),l()},set value(f){At(r,f)},$$legacy:!0})}}})},$$slots:{default:!0}}),S(g),p(n,h)},$$slots:{default:!0}}),S(m),p(a,v),Z()}var Je=x("<!> <!> <!> <!> <!> <!>",1);function Qe(a,t){X(t,!1);const e=dt(),l=()=>F(v,"$globalNotetype",e),s=()=>F(m,"$deckId",e),o=()=>F(r,"$metadata",e);let i=D(t,"state",8);const r=i().metadata,v=i().globalNotetype,m=i().deckId,n={notetype:{title:Nt(),help:pe(),url:L.TextImporting.root},deck:{title:xt(),help:me(),url:L.TextImporting.root},dupeResolution:{title:ve(),help:ge(),url:L.TextImporting.updating},matchScope:{title:fe(),help:$e(),url:L.TextImporting.updating},globalTags:{title:he(),help:be(),url:L.TextImporting.root},updatedTags:{title:ye(),help:_e(),url:L.TextImporting.root}},I=Object.values(n);let h=Y(),b=Y();function g(P){u(h).show(),u(b).to(P)}Q();var c=E(()=>wt());It(a,{get title(){return u(c)},children:(P,O)=>{var T=Je(),f=R(T);{var y=d=>{var V=E(()=>i().notetypeNameIds.map(({id:$,name:U})=>({label:U,value:$})));nt(d,{get defaultValue(){return i().defaultNotetypeId},get choices(){return u(V)},get value(){return l().id},set value($){B(v,C(l).id=$,C(l))},children:($,U)=>{K($,{$$events:{click:()=>g(Object.keys(n).indexOf("notetype"))},children:(w,Lt)=>{q();var st=W();A(()=>z(st,n.notetype.title)),p(w,st)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};Ct(f,d=>{l()!==null&&d(y)})}var N=M(f,2);{var H=d=>{var V=E(()=>i().deckNameIds.map(({id:$,name:U})=>({label:U,value:$})));nt(d,{get defaultValue(){return i().defaultDeckId},get choices(){return u(V)},get value(){return zt(),s()},set value($){At(m,$)},children:($,U)=>{K($,{$$events:{click:()=>g(Object.keys(n).indexOf("deck"))},children:(w,Lt)=>{q();var st=W();A(()=>z(st,n.deck.title)),p(w,st)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};Ct(N,d=>{s()!==null&&d(H)})}var _=M(N,2),G=E(ze);nt(_,{defaultValue:0,get choices(){return u(G)},get value(){return o().dupeResolution},set value(d){B(r,C(o).dupeResolution=d,C(o))},children:(d,V)=>{K(d,{$$events:{click:()=>g(Object.keys(n).indexOf("dupeResolution"))},children:($,U)=>{q();var w=W();A(()=>z(w,n.dupeResolution.title)),p($,w)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var j=M(_,2),lt=E(Fe);nt(j,{defaultValue:0,get choices(){return u(lt)},get value(){return o().matchScope},set value(d){B(r,C(o).matchScope=d,C(o))},children:(d,V)=>{K(d,{$$events:{click:()=>g(Object.keys(n).indexOf("matchScope"))},children:($,U)=>{q();var w=W();A(()=>z(w,n.matchScope.title)),p($,w)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var ct=M(j,2);Et(ct,{keyCombination:"Control+T",get tags(){return o().globalTags},set tags(d){B(r,C(o).globalTags=d,C(o))},children:(d,V)=>{K(d,{$$events:{click:()=>g(Object.keys(n).indexOf("globalTags"))},children:($,U)=>{q();var w=W();A(()=>z(w,n.globalTags.title)),p($,w)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var $t=M(ct,2);Et($t,{keyCombination:"Control+Shift+T",get tags(){return o().updatedTags},set tags(d){B(r,C(o).updatedTags=d,C(o))},children:(d,V)=>{K(d,{$$events:{click:()=>g(Object.keys(n).indexOf("updatedTags"))},children:($,U)=>{q();var w=W();A(()=>z(w,n.updatedTags.title)),p($,w)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0}),p(P,T)},$$slots:{default:!0,tooltip:(P,O)=>{var T=E(()=>wt());Ft(P,{get title(){return u(T)},get url(){return L.TextImporting.root},slot:"tooltip",helpSections:I,$$events:{mount:f=>{J(h,f.detail.modal),J(b,f.detail.carousel)}}})}}}),Z()}var Xe=x("<!> <!> <!>",1);function Ze(a,t){X(t,!1);let e=D(t,"state",8);Q(),Ce(a,{get path(){return e().path},get importer(){return e()},children:(l,s)=>{var o=Xe(),i=R(o);ut(i,{children:(m,n)=>{Be(m,{get state(){return e()}})},$$slots:{default:!0}});var r=M(i,2);ut(r,{children:(m,n)=>{Qe(m,{get state(){return e()}})},$$slots:{default:!0}});var v=M(r,2);ut(v,{children:(m,n)=>{je(m,{get state(){return e()}})},$$slots:{default:!0}}),p(l,o)},$$slots:{default:!0}}),Z()}function ka(a,t){X(t,!1);let e=D(t,"data",8);Q(),Ze(a,{get state(){return e().state}}),Z()}export{ka as component,_a as universal};
