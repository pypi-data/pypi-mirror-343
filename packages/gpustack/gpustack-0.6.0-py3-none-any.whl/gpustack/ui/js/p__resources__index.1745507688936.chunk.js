"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[485],{76932:function(e,n,t){t.d(n,{Z:function(){return k}});var r,a=t(26068),s=t.n(a),o=t(53649),l=t.n(o),i=t(50959),d=t(1128),c=t(63417),u=t(67825),m=t.n(u),h=t(96938),p=t(11527),f=["height","size","options","className"],g=d.ZP.div(r||(r=l()(["\n  .ant-segmented.segment-line {\n    padding: 0;\n    background-color: transparent;\n    color: var(--color-white-tertiary);\n    border: none;\n    box-shadow: none;\n    height: ","px;\n    display: flex;\n    align-items: center;\n    .ant-segmented-group {\n      gap: 16px;\n      height: 100%;\n    }\n    .ant-segmented-item:hover {\n      color: var(--color-white-secondary);\n    }\n    .ant-segmented-thumb {\n      height: 2px;\n      padding: 0px;\n      bottom: 0px;\n      top: unset;\n    }\n    .ant-segmented-item-label {\n      display: flex;\n      align-items: center;\n      padding: 0;\n      font-size: var(--font-size-small);\n    }\n    .ant-segmented-item {\n      background-color: transparent;\n      padding-bottom: 2px;\n      display: flex;\n      align-items: center;\n      &::after {\n        background-color: var(--color-white-primary) !important;\n        width: 100%;\n        height: 0px;\n        border-radius: 2px;\n        bottom: 0px;\n        top: unset;\n      }\n    }\n    .ant-segmented-item-selected {\n      background-color: transparent;\n      color: var(--color-white-primary);\n      &::after {\n        height: 2px;\n      }\n    }\n  }\n"])),(function(e){return e.$height})),x=function(e){var n=e.height,t=void 0===n?32:n,r=e.size,a=void 0===r?"small":r,o=e.options,l=void 0===o?[]:o,i=e.className,d=void 0===i?"segment-line":i,c=m()(e,f);return(0,p.jsx)(g,{$height:t,children:(0,p.jsx)(h.Z,s()(s()({},c),{},{size:a,options:l,className:d}))})};x.displayName="SegmentLine";var v,b=x,j=d.ZP.div(v||(v=l()(["\n  height: ","px;\n"])),(function(e){return e.$height})),y=function(e){var n=e.headerHeight,t=void 0===n?40:n,r=e.header,a=e.children,o=e.copyText,l=e.langOptions,i=void 0===l?[]:l,d=e.onChangeLang,u=e.defaultValue,m=e.styles,h=void 0===m?{}:m,f=e.showHeader,g=void 0===f||f,x=function(e){null==d||d(e)};return(0,p.jsxs)("div",{className:"editor-wrap",style:s()({},h.wrapper),children:[r?(0,p.jsx)("div",{className:"editor-header",children:r}):g?(0,p.jsxs)(j,{className:"editor-header",$height:t,children:[(0,p.jsx)(b,{height:t,defaultValue:u,size:"small",options:i,onChange:x}),(0,p.jsx)(c.Z,{text:o,size:"small",style:{color:"rgba(255,255,255,.7)"}})]}):null,(0,p.jsx)("div",{className:"editor-content",children:a})]})},k=i.memo(y)},60259:function(e,n,t){t.r(n),t.d(n,{default:function(){return wn}});var r=t(48305),a=t.n(r),s=t(53649),o=t.n(s),l=t(9389),i=(0,t(74901).O4)("tabActiveStatus",new Map),d={resources:"resources"};function c(){return{setTabActive:function(e,n){!function(e,n){var t=(0,l.K7)(),r=t.get(i);r.set(e,n),t.set(i,r)}(e,n)},getTabActive:function(e){return function(e){return(0,l.K7)().get(i).get(e)}(e)},tabsMap:d}}var u,m,h,p,f,g,x=t(67581),v=t(38551),b=t(50959),j=t(1128),y=t(16204),k=t(62722),w=t(9288),_=t(23333),Z=t(11527),M=(0,b.memo)((function(e){var n=e.open,t=e.percent,r=e.download,a=e.label,s=e.successPercent,o=(0,b.useMemo)((function(){return r?"var(--ant-color-primary)":t<=50?"var(--color-progress-green)":t<=80?"var(--ant-color-warning)":"var(--ant-color-error)"}),[t]),l=(0,b.useMemo)((function(){return(0,Z.jsx)(w.Z,{percentPosition:{align:"center",type:"inner"},size:["",16],format:function(){return(0,Z.jsxs)("span",{style:{color:"#fff"},children:[t,"%"]})},percent:t,success:{percent:s,strokeColor:"var(--ant-geekblue-3)"},strokeColor:o})}),[t,s,o]);return(0,Z.jsx)(Z.Fragment,{children:a?(0,Z.jsx)(_.Z,{title:a,open:n,overlayInnerStyle:{paddingInline:12},children:l}):l})})),I=M,C=t(63597),S=t(44336),P=t(58258),z=t(29687),N=t(23010),L=t(82930),T=t(32699),F=t.n(T),O=t(61555),G=z.Z.Column,W=[{label:"resources.table.total",key:"total",locale:!0,render:function(e){return(0,P.hy)(e,0)}},{label:"resources.table.used",key:"used",locale:!0,render:function(e){return(0,P.hy)(e,0)}},{label:"resources.table.allocated",key:"allocated",locale:!0,render:function(e){return(0,P.hy)(e,0)}}],D=function(){var e=(0,S.Z)({fetchAPI:O.oz}),n=e.dataSource,t=e.queryParams,r=e.handlePageChange,a=e.handleTableChange,s=e.handleSearch,o=e.handleNameChange,l=(0,v.useIntl)();return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(k.f,{buttonText:l.formatMessage({id:"resources.button.create"}),handleSearch:s,handleInputChange:o,showDeleteButton:!1,showPrimaryButton:!1,width:{input:300}}),(0,Z.jsx)(L.ZP,{renderEmpty:function(e){if("Table"===e)return n.loading||!n.loadend||n.dataList.length?(0,Z.jsx)("div",{}):(0,Z.jsx)(N.Z,{image:N.Z.PRESENTED_IMAGE_SIMPLE})},children:(0,Z.jsxs)(z.Z,{tableLayout:n.loadend?"auto":"fixed",dataSource:n.dataList,loading:n.loading,rowKey:"id",onChange:a,pagination:{showSizeChanger:!0,pageSize:t.perPage,current:t.page,total:n.total,hideOnSinglePage:10===t.perPage,onChange:r},children:[(0,Z.jsx)(G,{title:l.formatMessage({id:"common.table.name"}),dataIndex:"name",width:240,render:function(e,n){return(0,Z.jsx)(y.Z,{ghost:!0,maxWidth:240,children:e})}},"name"),(0,Z.jsx)(G,{title:l.formatMessage({id:"resources.table.index"}),dataIndex:"index",render:function(e,n){return(0,Z.jsx)("span",{children:n.index})}},"index"),(0,Z.jsx)(G,{title:l.formatMessage({id:"resources.table.workername"}),dataIndex:"worker_name",width:200,render:function(e,n){return(0,Z.jsx)("span",{style:{display:"flex",width:"100%"},children:(0,Z.jsx)(y.Z,{ghost:!0,maxWidth:340,children:e})})}},"worker_name"),(0,Z.jsx)(G,{title:l.formatMessage({id:"resources.table.vender"}),dataIndex:"vendor"},"vendor"),(0,Z.jsx)(G,{title:"".concat(l.formatMessage({id:"resources.table.temperature"})," (Â°C)"),dataIndex:"temperature",render:function(e,n){return(0,Z.jsx)("span",{children:e?F().round(e,1):"-"})}},"Temperature"),(0,Z.jsx)(G,{title:l.formatMessage({id:"resources.table.gpuutilization"}),dataIndex:"gpuUtil",render:function(e,n){var t;return(0,Z.jsx)(Z.Fragment,{children:n.core?(0,Z.jsx)(I,{percent:F().round(null===(t=n.core)||void 0===t?void 0:t.utilization_rate,2)}):"-"})}},"gpuUtil"),(0,Z.jsx)(G,{title:l.formatMessage({id:"resources.table.vramutilization"}),dataIndex:"VRAM",render:function(e,n){var t,r,a,s;return(0,Z.jsx)(I,{percent:null!==(t=n.memory)&&void 0!==t&&t.used?F().round(null===(r=n.memory)||void 0===r?void 0:r.utilization_rate,0):100*F().round((null===(a=n.memory)||void 0===a?void 0:a.allocated)/(null===(s=n.memory)||void 0===s?void 0:s.total),0),label:(0,Z.jsx)(C.Z,{fieldList:W,data:n.memory})})}},"VRAM")]})})]})},E=t(90228),A=t.n(E),q=t(26068),V=t.n(q),R=t(87999),H=t.n(R),B=t(47820),U=t(92800),$=t(59597),K=t(62605),J=t(57160),Y=t(20369),Q=t(97226),X=t(32246),ee=t(54713),ne=t(45724),te=t(57989),re=t(25232),ae=t(56394),se=t(67768),oe=t(43943),le=t(97536),ie=t(85885),de=t(2377),ce=t(82735),ue=t(5857),me=t(55656),he=t(42234),pe=t(68687),fe=t(49280),ge=t(47919),xe=t(39139),ve=t(55825),be=t(66392),je=t(68476),ye=t(87497),ke=(0,b.forwardRef)((function(e,n){var t=e.onOk,r=e.source,s=e.workersList,o=(0,Q.Z)().getRuleMessage,l=(0,v.useIntl)(),i=je.Z.useForm(),d=a()(i,1)[0];(0,b.useImperativeHandle)(n,(function(){return{form:d}}));var c=(0,b.useMemo)((function(){return e.source===te.bI.ollama_library_value?(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(je.Z.Item,{name:"ollama_library_model_name",rules:[{required:!0,message:o("input","models.table.name")}],children:(0,Z.jsx)(ge.Z,{allowClear:!0,filterOption:!0,defaultActiveFirstOption:!0,disabled:!1,options:te.Bu,description:(0,Z.jsxs)("span",{children:[(0,Z.jsx)("span",{children:l.formatMessage({id:"models.form.ollamalink"})}),(0,Z.jsx)(ye.Z.Link,{className:"flex-center",href:"https://www.ollama.com/library",target:"_blank",children:(0,Z.jsx)(fe.Z,{type:"icon-external-link",className:"font-size-14"})})]}),label:l.formatMessage({id:"model.form.ollama.model"}),placeholder:l.formatMessage({id:"model.form.ollamaholder"}),required:!0})},"ollama_library_model_name")}):e.source===te.bI.local_path_value?(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(je.Z.Item,{name:"local_path",rules:[{required:!0,message:o("input","models.form.filePath")}],children:(0,Z.jsx)(xe.Z.Input,{required:!0,label:l.formatMessage({id:"models.form.filePath"}),description:(0,Z.jsx)(be.Z,{list:te.G})})},"local_path")}):null}),[e.source,l]);return(0,Z.jsxs)(je.Z,{form:d,onFinish:function(e){var n=F().pickBy(e,(function(e){return e}));t(n)},preserve:!1,style:{padding:"16px 24px"},clearOnDestroy:!0,initialValues:{source:r},children:[(0,Z.jsx)(je.Z.Item,{name:"source",rules:[{required:!0,message:o("select","models.form.source")}],children:(0,Z.jsx)(ve.Z,{disabled:!0,label:l.formatMessage({id:"models.form.source"}),options:te.YB,required:!0})}),c,(0,Z.jsx)(je.Z.Item,{name:"worker_id",rules:[{required:!0,message:o("select","worker",!1)}],children:(0,Z.jsx)(ve.Z,{label:"Worker",options:s,required:!0})}),r!==te.bI.local_path_value&&(0,Z.jsx)(je.Z.Item,{name:"local_dir",rules:[{required:!1,message:o("input","resources.modelfiles.form.localdir")}],children:(0,Z.jsx)(xe.Z.Input,{description:(0,Z.jsx)("span",{dangerouslySetInnerHTML:{__html:l.formatMessage({id:"resources.modelfiles.form.localdir.tips"})}}),label:l.formatMessage({id:"resources.modelfiles.form.localdir"})})})]})})),we=function(e){var n=e||{},t=n.title,r=n.workersList,s=n.open,o=n.onOk,l=n.onCancel,i=n.hasLinuxWorker,d=n.source,c=n.width,u=void 0===c?600:c,m=[te.bI.huggingface_value,te.bI.modelscope_value],h=(0,b.useRef)({}),p=(0,v.useIntl)(),f=(0,b.useState)({}),g=a()(f,2),x=g[0],j=g[1],y=(0,b.useState)(!1),k=a()(y,2),w=k[0],_=k[1],M=(0,b.useState)(!1),I=a()(M,2),C=I[0],S=I[1],P=(0,b.useState)(""),z=a()(P,2),N=z[0],L=z[1],F=(0,b.useRef)(null),O=(0,b.useCallback)((function(e){L(e.fakeName)}),[]),G=(0,T.debounce)((function(){var e,n;null===(e=F.current)||void 0===e||null===(n=e.fetchModelFiles)||void 0===n||n.call(e)}),300),W=(0,b.useCallback)((function(){null==l||l()}),[l]);return(0,b.useEffect)((function(){O({fakeName:""})}),[x]),(0,b.useEffect)((function(){var e,n;(s?d===te.bI.ollama_library_value&&S(!0):S(!1),s)&&(null===(e=h.current)||void 0===e||null===(e=e.form)||void 0===e||e.setFieldValue("worker_id",(null===(n=r[0])||void 0===n?void 0:n.value)||""));return function(){j({})}}),[s,d]),(0,Z.jsx)(le.Z,{title:(0,Z.jsxs)("div",{className:"flex-between flex-center",children:[(0,Z.jsx)("span",{style:{color:"var(--ant-color-text)",fontWeight:"var(--font-weight-medium)",fontSize:"var(--font-size-middle)"},children:t}),(0,Z.jsx)(ie.ZP,{type:"text",size:"small",onClick:W,children:(0,Z.jsx)(oe.Z,{})})]}),open:s,onClose:W,destroyOnClose:!0,closeIcon:!1,maskClosable:!1,keyboard:!1,zIndex:2e3,styles:{body:{height:"calc(100vh - 57px)",padding:"16px 0",overflowX:"hidden"},content:{borderRadius:"6px 0 0 6px"}},width:u,footer:!1,children:(0,Z.jsxs)("div",{style:{display:"flex",height:"100%"},children:[m.includes(e.source)&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("div",{style:{display:"flex",flex:1,maxWidth:"33.33%"},children:[(0,Z.jsx)(de.Z,{children:(0,Z.jsx)(me.Z,{hasLinuxWorker:i,modelSource:e.source,onSelectModel:function(e){j(e)},isDownload:!0})}),(0,Z.jsx)(he.Z,{})]}),(0,Z.jsxs)("div",{style:{display:"flex",flex:1,maxWidth:"33.33%"},children:[(0,Z.jsxs)(de.Z,{children:[(0,Z.jsx)(ue.Z,{selectedModel:x,onCollapse:_,collapsed:w,modelSource:e.source,setIsGGUF:function(e){S(e),e&&G()}}),C&&(0,Z.jsx)(ce.Z,{ref:F,selectedModel:x,modelSource:e.source,onSelectFile:O,collapsed:w,isDownload:!0})]}),(0,Z.jsx)(he.Z,{})]})]}),(0,Z.jsx)("div",{style:{display:"flex",flex:1,maxWidth:"100%"},children:(0,Z.jsx)(de.Z,{paddingBottom:50,footer:(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(se.Z,{onCancel:W,onOk:function(){var e,n;null===(e=h.current)||void 0===e||null===(e=e.form)||void 0===e||null===(n=e.submit)||void 0===n||n.call(e)},style:{padding:"16px 24px",display:"flex",justifyContent:"flex-end"}})}),children:(0,Z.jsxs)(Z.Fragment,{children:[m.includes(d)&&(0,Z.jsxs)(pe.Z,{children:[p.formatMessage({id:"resources.modelfiles.selecttarget"}),(0,Z.jsx)("span",{style:{display:"flex",height:24}})]}),(0,Z.jsx)(ke,{ref:h,onOk:function(e){o(V()(V()({},e),{},{source:d},d===te.bI.huggingface_value?{huggingface_repo_id:x.name,huggingface_filename:N}:d===te.bI.modelscope_value?{model_scope_model_id:x.name,model_scope_file_path:N}:{}))},source:d,workersList:r})]})})})]})})},_e=t(26268),Ze=t(5268),Me=t(4423),Ie=t(76808),Ce=t(40174),Se=t(7672),Pe=t.n(Se),ze=t(79416),Ne=t(67303),Le=t(63878),Te=ye.Z.Paragraph,Fe=/^(.*?)(?:-\d+-of-\d+)?(\.gguf)?$/,Oe=j.ZP.div(u||(u=o()(["\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  height: 100%;\n  &::after {\n    content: '';\n    display: block;\n    width: 20px;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 1;\n  }\n  .btn-wrapper {\n    display: flex;\n    opacity: 0;\n    width: 0;\n    align-items: center;\n  }\n  &:hover {\n    .btn-wrapper {\n      width: auto;\n      opacity: 1;\n    }\n  }\n"]))),Ge=j.ZP.ul(m||(m=o()(["\n  max-width: 300px;\n  margin: 0;\n  padding-inline: 13px 0;\n  word-break: break-word;\n  li {\n    line-height: 1.6;\n  }\n"]))),We=(0,j.ZP)(Ie.Z)(h||(h=o()(["\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  margin-inline: 4px 0;\n  height: 22px;\n  border-radius: var(--border-radius-base);\n"]))),De=j.ZP.div(p||(p=o()(["\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  height: 100%;\n"]))),Ee=(0,j.ZP)(Te)(f||(f=o()(["\n  background: transparent;\n  color: inherit;\n  margin-bottom: 0;\n  font-size: 13px;\n"]))),Ae=function(e){var n=e.path,t=(0,v.useIntl)();return(0,Z.jsx)(Ee,{style:{margin:0},copyable:{icon:[(0,Z.jsx)(_e.Z,{},"copy-icon"),(0,Z.jsx)(Ze.Z,{},"copied-icon")],text:n,tooltips:[t.formatMessage({id:"common.button.copy"}),t.formatMessage({id:"common.button.copied"})]},children:n})},qe=function(e,n){var t=n.find((function(n){return n.value===e}));return(null==t?void 0:t.label)||""},Ve=function(e){var n=e.data;return n.state?(0,Z.jsx)(J.Z,{download:n.state===Le.$F.Downloading?{percent:n.download_progress}:void 0,statusValue:{status:n.state===Le.$F.Downloading&&100===n.download_progress?Le.no[Le.$F.Ready]:Le.no[n.state],text:Le.w[n.state],message:n.state===Le.$F.Downloading&&100===n.download_progress?"":n.state_message}}):null},Re=function(e){var n,t=e.record,r=(0,v.useIntl)(),a=t.resolved_paths||[];if(a.length<=1)return null;return(0,Z.jsx)(K.$,{title:(0,Z.jsx)(Ge,{children:a.map((function(e,n){return(0,Z.jsx)("li",{children:F().split(e,/[\\/]/).pop()},n)}))}),children:(0,Z.jsx)(We,{color:"purple",icon:(0,Z.jsx)(Me.Z,{}),children:(0,Z.jsxs)("span",{style:{opacity:1},children:[null===(n=t.resolved_paths)||void 0===n?void 0:n.length," ",r.formatMessage({id:"models.form.files"})]})})})},He=function(e){var n,t,r,a=e.record,s=(0,v.useIntl)();return a.resolved_paths.length||a.state!==Le.$F.Downloading?(null===(n=a.resolved_paths)||void 0===n?void 0:n.length)>0&&(0,Z.jsxs)(Oe,{children:[(0,Z.jsx)(De,{children:(0,Z.jsx)(y.Z,{ghost:!0,showTitle:!0,title:(0,Z.jsx)(Ae,{path:null===(t=a.resolved_paths)||void 0===t?void 0:t[0]}),children:(0,Z.jsx)("span",{children:(r=a.resolved_paths,F().split(null==r?void 0:r[0],/[\\/]/).pop())})})}),(0,Z.jsx)(Re,{record:a})]}):(0,Z.jsx)("span",{children:s.formatMessage({id:"resources.modelfiles.storagePath.holder"})})},Be=function(){var e=(0,Ne.W7)().getGPUList,n=(0,X.Z)(),t=n.saveScrollHeight,r=n.restoreScrollHeight,s=(0,ze.KO)(B.m),o=a()(s,2),l=(o[0],o[1]),i=(0,v.useNavigate)(),d=(0,S.Z)({fetchAPI:O.QV,deleteAPI:O.bO,API:O.qx,watch:!0,contentForDelete:"resources.modelfiles.modelfile"}),c=d.dataSource,u=d.rowSelection,m=d.queryParams,h=d.modalRef,p=d.fetchData,f=d.handleDelete,g=d.handleDeleteBatch,x=d.handlePageChange,j=d.handleTableChange,w=d.handleSearch,_=d.handleNameChange,M=d.handleQueryChange,I=(0,Ne.ml)(),C=I.getModelFileList,T=I.generateModelFileOptions,G=(0,v.useIntl)(),W=(0,Q.Z)().showSuccess,D=(0,b.useState)([]),E=a()(D,2),q=E[0],R=E[1],K=(0,b.useState)({show:!1,width:600,hasLinuxWorker:!1,source:te.bI.huggingface_value,gpuOptions:[]}),J=a()(K,2),se=J[0],oe=J[1],le=(0,b.useState)({show:!1,width:600,source:te.bI.local_path_value,gpuOptions:[],modelFileOptions:[],initialValues:{},isGGUF:!1}),ie=a()(le,2),de=ie[0],ce=ie[1];(0,b.useEffect)((function(){var e=function(){var e=H()(A()().mark((function e(){var n,t,r;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,O.Sw)({page:1,perPage:100});case 3:t=e.sent,r=null===(n=t.items)||void 0===n?void 0:n.map((function(e){return V()(V()({},e),{},{value:e.id,label:e.name})})),R(r),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();e()}),[]);var ue=function(e){return e.replace(Fe,"$1")},me=function(e,n){var t,r,a,s,o=F().includes(null===(t=e.resolved_paths)||void 0===t?void 0:t[0],"gguf"),l=!!e.ollama_library_model_name,i=(0,re.zG)(e.source,null===(r=e.resolved_paths)||void 0===r?void 0:r[0]),d=F().toLower(F().split(e.huggingface_repo_id||e.ollama_library_model_name||e.model_scope_model_id||e.local_path,/[\\/]/).pop()),c=null===(a=F().find(q,{value:e.worker_id}))||void 0===a||null===(a=a.labels)||void 0===a?void 0:a["worker-name"];return{source:te.bI.local_path_value,local_path:null===(s=e.resolved_paths)||void 0===s?void 0:s[0],worker_selector:c?{"worker-name":c}:{},name:ue(d),backend:(0,Ne.RM)({isGGUF:!i&&(o||l),isAudio:!!i,gpuOptions:n,defaultBackend:te.sk.vllm}),isGGUF:!i&&(o||l)}},he=function(){var n=H()(A()().mark((function n(r,s){var o,l,i,d,c,u,m;return A()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,"delete"!==r){n.next=5;break}f(V()(V()({},s),{},{name:null===(o=s.resolved_paths)||void 0===o?void 0:o[0]}),{checkConfig:{checkText:"resources.modelfiles.delete.tips",defautlChecked:s.source!==te.bI.local_path_value}}),n.next=22;break;case 5:if("retry"!==r){n.next=11;break}return n.next=8,(0,O.m_)(s.id);case 8:W(),n.next=22;break;case 11:if("deploy"!==r){n.next=22;break}return t(),n.next=15,Promise.all([C(),e()]);case 15:l=n.sent,i=a()(l,2),d=i[0],c=i[1],u=T(d,q),m=me(s,c),ce(V()(V()({},de),{},{modelFileOptions:u,gpuOptions:c,initialValues:m,isGGUF:m.isGGUF,show:!0}));case 22:n.next=26;break;case 24:n.prev=24,n.t0=n.catch(0);case 26:case"end":return n.stop()}}),n,null,[[0,24]])})));return function(e,t){return n.apply(this,arguments)}}(),pe=(0,b.useCallback)((function(e){var n=ae.NQ[e.key],t=q.some((function(e){var n;return"linux"===F().toLower(null===(n=e.labels)||void 0===n?void 0:n.os)}));n&&oe(V()(V()({},n),{},{hasLinuxWorker:t,gpuOptions:[]}))}),[q]),fe=function(){var e=H()(A()().mark((function e(n){return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,O.Pe)(n);case 3:oe(V()(V()({},se),{},{show:!1})),p(),W(),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(n){return e.apply(this,arguments)}}(),ge=function(e){return F().filter(ae.JD,(function(n){return"deploy"!==n.key||e.state===Le.$F.Ready}))},xe=function(){var e=H()(A()().mark((function e(n){var t;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,ee.NY)({data:n});case 3:t=e.sent,ce(V()(V()({},de),{},{show:!1})),Ce.ZP.success(G.formatMessage({id:"common.message.success"})),l([t.id]),i("/models/list"),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(n){return e.apply(this,arguments)}}(),ve=[{title:G.formatMessage({id:"models.form.source"}),dataIndex:"source",render:function(e,n){var t=function(e){return e.source===te.bI.huggingface_value?{repo_id:e.huggingface_repo_id,title:"".concat(e.huggingface_repo_id,"/").concat(e.huggingface_filename),filename:e.huggingface_filename||e.huggingface_repo_id}:e.source===te.bI.modelscope_value?{repo_id:e.model_scope_model_id,title:"".concat(e.model_scope_model_id,"/").concat(e.model_scope_file_path),filename:e.model_scope_file_path||e.model_scope_model_id}:e.source===te.bI.ollama_library_value?{repo_id:e.ollama_library_model_name,title:e.ollama_library_model_name,filename:e.ollama_library_model_name}:{repo_id:e.local_path,title:e.local_path,filename:F().split(e.local_path,/[\\/]/).pop()}}(n),r=t.repo_id;return(0,Z.jsx)(De,{children:(0,Z.jsx)(y.Z,{ghost:!0,showTitle:!0,title:r,children:F().get(te.bI,n.source,"")})})}},{title:"Worker",dataIndex:"worker_name",render:function(e,n){return(0,Z.jsx)(y.Z,{ghost:!0,children:(0,Z.jsx)("span",{children:qe(n.worker_id,q)})})}},{title:G.formatMessage({id:"common.table.status"}),dataIndex:"state",width:120,render:function(e,n){return(0,Z.jsx)(Ve,{data:n})}},{title:G.formatMessage({id:"resources.modelfiles.form.path"}),dataIndex:"resolved_paths",width:"35%",render:function(e,n){return(0,Z.jsx)(He,{record:n})}},{title:G.formatMessage({id:"resources.modelfiles.size"}),dataIndex:"size",width:100,render:function(e,n){return(0,Z.jsx)(y.Z,{ghost:!0,maxWidth:100,children:(0,Z.jsx)("span",{children:(0,P.hy)(n.size,1,!0)})})}},{title:G.formatMessage({id:"common.table.createTime"}),dataIndex:"created_at",sorter:!1,width:180,render:function(e){return(0,Z.jsx)(y.Z,{ghost:!0,children:Pe()(e).format("YYYY-MM-DD HH:mm:ss")})}},{title:G.formatMessage({id:"common.table.operation"}),dataIndex:"operation",width:120,render:function(e,n){return(0,Z.jsx)($.Z,{items:ge(n),onSelect:function(e){return he(e,n)}})}}],be=(0,b.useMemo)((function(){return q.filter((function(e){return e.state===Le.jX.ready}))}),[q]);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(k.f,{actionType:"dropdown",selectHolder:"resources.filter.worker",inputHolder:"resources.filter.path",buttonText:G.formatMessage({id:"resources.modelfiles.download"}),handleSelectChange:function(e){M({page:1,worker_id:e})},handleDeleteByBatch:function(){g({checkConfig:{checkText:"resources.modelfiles.delete.tips",defautlChecked:!1}})},handleClickPrimary:pe,handleSearch:w,selectOptions:q,handleInputChange:_,rowSelection:u,actionItems:ae.qL,showSelect:!0}),(0,Z.jsx)(L.ZP,{renderEmpty:function(e){if("Table"===e)return c.loading||!c.loadend||c.dataList.length?(0,Z.jsx)("div",{}):(0,Z.jsx)(N.Z,{image:N.Z.PRESENTED_IMAGE_SIMPLE})},children:(0,Z.jsx)(z.Z,{rowKey:"id",tableLayout:"fixed",style:{width:"100%"},onChange:j,dataSource:c.dataList,loading:c.loading,rowSelection:u,columns:ve,pagination:{showSizeChanger:!0,pageSize:m.perPage,current:m.page,total:c.total,hideOnSinglePage:10===m.perPage,onChange:x}})}),(0,Z.jsx)(U.Z,{ref:h}),(0,Z.jsx)(we,{onCancel:function(){oe(V()(V()({},se),{},{show:!1}))},onOk:fe,title:G.formatMessage({id:"resources.modelfiles.download"}),open:se.show,source:se.source,width:se.width,hasLinuxWorker:se.hasLinuxWorker,workersList:be}),(0,Z.jsx)(ne.Z,{deploymentType:"modelFiles",title:G.formatMessage({id:"models.button.deploy"}),onCancel:function(){ce(V()(V()({},de),{},{show:!1})),r()},onOk:xe,open:de.show,action:Y.Kd.CREATE,source:de.source,width:de.width,gpuOptions:de.gpuOptions,modelFileOptions:de.modelFileOptions||[],initialValues:de.initialValues,isGGUF:de.isGGUF})]})},Ue=t(82344),$e=t(48660),Ke=t(69070),Je=t(94299),Ye=t(1956),Qe=t(47946),Xe=t(78666),en=t(28100),nn=t(76932),tn=t(43585),rn=t(81454),an=[{label:"910B",value:"npu"},{label:"310P",value:"npu310p"}],sn=function(e){var n=(0,v.useIntl)(),t=window.location.origin,r=b.useState("cuda"),s=a()(r,2),o=s[0],l=s[1],i=b.useState("npu"),d=a()(i,2),c=d[0],u=d[1],m=(0,en.bG)(Xe.jr),h=b.useMemo((function(){var e,n=null==m?void 0:m.version;n&&m.isProduction||(n="main");var r=Le.Jq[o];"npu310p"===c&&"npu"===o&&(r=Le.Jq[c]);var a="cuda"===o?n:"".concat(n,"-").concat(o);return null===(e=r)||void 0===e?void 0:e.registerWorker({server:t,tag:a,token:"${token}",workerip:"${workerip}"})}),[m,o,e.token,c]);return(0,Z.jsxs)("div",{className:"container-install",children:[(0,Z.jsxs)("ul",{className:"notes",children:[(0,Z.jsx)("li",{children:n.formatMessage({id:"resources.worker.current.version"},{version:m.version})}),(0,Z.jsx)("li",{children:(0,Z.jsx)("span",{dangerouslySetInnerHTML:{__html:n.formatMessage({id:"resources.worker.driver.install"})}})})]}),(0,Z.jsxs)("h3",{className:"font-size-14 font-600",children:["1."," ",(0,Z.jsx)("span",{dangerouslySetInnerHTML:{__html:n.formatMessage({id:"resources.worker.add.step1"})}})]}),(0,Z.jsx)(tn.Z,{code:Le.Jq.container.getToken,theme:"dark",lang:"bash"}),(0,Z.jsxs)("h3",{className:"m-t-10 font-size-14 font-600",children:["2. ",n.formatMessage({id:"resources.worker.add.step2"})," ",(0,Z.jsx)("span",{className:"font-size-12",style:{color:"var(--ant-color-text-tertiary)"},dangerouslySetInnerHTML:{__html:"".concat(n.formatMessage({id:"resources.worker.add.step2.tips"}))}})]}),(0,Z.jsx)("div",{className:"m-b-16",children:(0,Z.jsx)(rn.ZP.Group,{block:!0,options:Le.KO,defaultValue:o,value:o,optionType:"button",buttonStyle:"solid",onChange:function(e){return l(e.target.value)},size:"small"})}),"npu"===o&&(0,Z.jsx)("div",{className:"m-b-8 text-tertiary",dangerouslySetInnerHTML:{__html:n.formatMessage({id:"resources.worker.cann.tips"})}}),"npu"===o?(0,Z.jsx)(nn.Z,{headerHeight:32,copyText:h,langOptions:an,defaultValue:"npu",showHeader:!0,onChangeLang:function(e){u(e)},styles:{wrapper:{backgroundColor:"var(--color-editor-dark)"}},children:(0,Z.jsx)(tn.Z,{theme:"dark",code:h.replace(/\\/g,""),copyValue:h,lang:"bash",copyable:!1})}):(0,Z.jsx)(tn.Z,{theme:"dark",code:h.replace(/\\/g,""),copyValue:h,lang:"bash"}),(0,Z.jsxs)("h3",{className:"m-b-0 m-t-10 font-size-14 font-600",children:["3. ",n.formatMessage({id:"resources.worker.add.step3"})]})]})},on=b.memo(sn),ln=function(e){var n=(0,v.useIntl)(),t=window.location.origin,r=(0,b.useMemo)((function(){return{step1:n.formatMessage({id:"resources.worker.add.step1"}),step2:n.formatMessage({id:"resources.worker.add.step2"}),step2Tips:n.formatMessage({id:"resources.worker.add.step2.tips"}),step3:n.formatMessage({id:"resources.worker.add.step3"}),linuxOrMac:n.formatMessage({id:"resources.worker.linuxormaxos"})}}),[n]);return(0,Z.jsxs)("div",{className:"script-install",children:[(0,Z.jsxs)("h3",{className:"font-size-14 font-600",children:["1. ",(0,Z.jsx)("span",{dangerouslySetInnerHTML:{__html:r.step1}})]}),(0,Z.jsx)("h4",{className:"font-size-13",children:r.linuxOrMac}),(0,Z.jsx)(tn.Z,{code:Le.Jq.mac.getToken,theme:"dark"}),(0,Z.jsx)("h4",{className:"m-t-6 font-size-13",children:"Windows "}),(0,Z.jsx)(tn.Z,{code:Le.Jq.win.getToken,theme:"dark"}),(0,Z.jsxs)("h3",{className:"m-t-10 font-size-14 font-600",children:["2. ",r.step2," ",(0,Z.jsx)("span",{className:"font-size-12",style:{color:"var(--ant-color-text-tertiary)"},dangerouslySetInnerHTML:{__html:"".concat(r.step2Tips)}})]}),(0,Z.jsx)("h4",{className:"font-size-13",children:r.linuxOrMac}),(0,Z.jsx)(tn.Z,{code:Le.Jq.mac.registerWorker({server:t,token:"${token}"}),theme:"dark"}),(0,Z.jsx)("h4",{className:"m-t-6 font-size-13",children:"Windows"}),(0,Z.jsx)(tn.Z,{theme:"dark",code:Le.Jq.win.registerWorker({server:t,token:"${token}"})}),(0,Z.jsxs)("h3",{className:"m-b-0 m-t-10 font-size-14 font-600",children:["3. ",r.step3]})]})},dn=b.memo(ln),cn=function(e){var n=e||{},t=n.open,r=n.onCancel,s=(0,v.useIntl)(),o=b.useState(""),l=a()(o,2),i=l[0],d=(l[1],b.useState("script")),c=a()(d,2),u=c[0],m=c[1],h=[{key:"script",label:s.formatMessage({id:"resources.worker.script.install"}),children:(0,Z.jsx)(dn,{token:i})},{key:"container",label:s.formatMessage({id:"resources.worker.container.install"}),children:(0,Z.jsx)(on,{token:i})}];return(0,Z.jsx)(Ye.Z,{title:s.formatMessage({id:"resources.button.create"}),open:t,centered:!0,onCancel:r,destroyOnClose:!0,closeIcon:!0,maskClosable:!1,keyboard:!1,width:700,styles:{body:{height:650}},footer:null,children:(0,Z.jsx)(Qe.Z,{size:"small",items:h,activeKey:u,type:"card",onChange:function(e){return m(e)}})})},un=b.memo(cn),mn=t(38634),hn=t(98817),pn=t(56377),fn=(t(64818),function(e){var n=e||{},t=n.open,r=n.onCancel,s=n.data,o=n.onOk,l=(0,v.useIntl)(),i=je.Z.useForm(),d=a()(i,1)[0],c=je.Z.useWatch("labels",d);return(0,Z.jsx)(hn.Z,{title:l.formatMessage({id:"resources.button.edit"}),open:t,centered:!0,onCancel:r,destroyOnClose:!0,closeIcon:!0,maskClosable:!1,keyboard:!1,width:600,styles:{content:{padding:"0px"},header:{padding:"var(--ant-modal-content-padding)",paddingBottom:"0"},body:{padding:"0"},footer:{padding:"0 var(--ant-modal-content-padding)"}},footer:(0,Z.jsx)(se.Z,{onOk:function(){d.submit()},onCancel:r}),children:(0,Z.jsx)(pn.Z,{style:{maxHeight:"550px"},children:(0,Z.jsxs)(je.Z,{name:"deployModel",form:d,onFinish:o,preserve:!1,clearOnDestroy:!0,initialValues:{name:s.name,labels:s.labels},style:{padding:"var(--ant-modal-content-padding)",paddingBlock:0},children:[(0,Z.jsx)(je.Z.Item,{name:"name",children:(0,Z.jsx)(xe.Z.Input,{label:l.formatMessage({id:"common.table.name"}),disabled:!0})}),(0,Z.jsx)(je.Z.Item,{name:"labels",rules:[function(){return{validator:function(e,n){return F().keys(n).length>0&&F().some(F().keys(n),(function(e){return!n[e]}))?Promise.reject(l.formatMessage({id:"common.validate.value"},{name:l.formatMessage({id:"resources.form.label"})})):Promise.resolve()}}}],children:(0,Z.jsx)(mn.Z,{label:l.formatMessage({id:"resources.table.labels"}),labels:c,btnText:"common.button.addLabel",onChange:function(e){d.setFieldValue("labels",e)}})})]})})})}),gn=b.memo(fn),xn=z.Z.Column,vn=[{label:"resources.table.total",key:"total",locale:!0,render:function(e){return(0,P.hy)(e,0)}},{label:"resources.table.used",key:"used",locale:!0,render:function(e){return(0,P.hy)(e,0)}},{label:"resources.table.allocated",key:"allocated",locale:!0,render:function(e){return(0,P.hy)(e,0)}}],bn=[{label:"common.button.edit",key:"edit",icon:(0,Z.jsx)($e.Z,{})},{label:"common.button.delete",key:"delete",props:{danger:!0},icon:(0,Z.jsx)(Ke.Z,{})}],jn=function(e,n){return n&&e?F().round(e/n*100,0):0},yn=function(){var e=(0,S.Z)({fetchAPI:O.Sw,deleteAPI:O.lM,contentForDelete:"worker"}),n=e.dataSource,t=e.rowSelection,r=e.queryParams,s=e.modalRef,o=e.handleDelete,l=e.handleDeleteBatch,i=e.fetchData,d=e.handlePageChange,c=e.handleTableChange,u=e.handleSearch,m=e.handleNameChange,h=(0,v.useIntl)(),p=(0,b.useState)(!1),f=a()(p,2),g=f[0],x=f[1],j=(0,b.useState)({open:!1,data:{}}),w=a()(j,2),M=w[0],P=w[1],T=function(){x(!0)},G=(0,b.useCallback)(function(){var e=H()(A()().mark((function e(n){return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,(0,O.Vq)(M.data.id,V()(V()({},M.data),{},{labels:n.labels}));case 4:Ce.ZP.success(h.formatMessage({id:"common.message.success"})),i(),P({open:!1,data:{}}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(n){return e.apply(this,arguments)}}(),[M,i]),W=(0,b.useCallback)((function(){P(V()(V()({},M),{},{open:!1}))}),[]),D=function(e,n){"edit"!==e?"delete"===e&&o(n):function(e){P({open:!0,data:V()({},e)})}(n)},E=function(e){var n=F().find(e,(function(e){return"/"===e.mount_point}));return n?(0,Z.jsx)(C.Z,{fieldList:vn.filter((function(e){return"allocated"!==e.key})),data:n}):0};return(0,Je.y1)(Ue.ZP.CREATE.join(","),T,{enabled:!g}),(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(k.f,{buttonText:h.formatMessage({id:"resources.button.create"}),handleDeleteByBatch:l,handleSearch:u,handleClickPrimary:T,handleInputChange:m,rowSelection:t,width:{input:300}}),(0,Z.jsx)(L.ZP,{renderEmpty:function(e){if("Table"===e)return n.loading||!n.loadend||n.dataList.length?(0,Z.jsx)("div",{}):(0,Z.jsx)(N.Z,{image:N.Z.PRESENTED_IMAGE_SIMPLE})},children:(0,Z.jsxs)(z.Z,{tableLayout:n.loadend?"auto":"fixed",style:{width:"100%"},dataSource:n.dataList,loading:n.loading,rowKey:"id",onChange:c,rowSelection:t,pagination:{showSizeChanger:!0,pageSize:r.perPage,current:r.page,total:n.total,hideOnSinglePage:10===r.perPage,onChange:d},children:[(0,Z.jsx)(xn,{title:h.formatMessage({id:"common.table.name"}),dataIndex:"name",width:100,render:function(e,n){return(0,Z.jsx)(y.Z,{ghost:!0,maxWidth:240,children:(0,Z.jsx)("span",{children:n.name})})}},"name"),(0,Z.jsx)(xn,{title:h.formatMessage({id:"resources.table.labels"}),dataIndex:"labels",width:200,render:function(e,n){return(0,Z.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:F().map(n.labels,(function(e,n){return(0,Z.jsxs)(y.Z,{className:"m-r-0",maxWidth:155,style:{paddingInline:8,borderRadius:12},children:[(0,Z.jsx)("span",{children:n}),(0,Z.jsxs)("span",{children:[":",e]})]},n)}))})}},"labels"),(0,Z.jsx)(xn,{title:h.formatMessage({id:"common.table.status"}),dataIndex:"state",render:function(e,n){return(0,Z.jsx)(J.Z,{statusValue:{status:Le.i7[n.state],text:Le.S7[n.state],message:n.state_message}})}},"state"),(0,Z.jsx)(xn,{title:"IP",dataIndex:"ip"},"address"),(0,Z.jsx)(xn,{title:"CPU",dataIndex:"CPU",render:function(e,n){var t;return(0,Z.jsx)(I,{percent:F().round(null==n||null===(t=n.status)||void 0===t||null===(t=t.cpu)||void 0===t?void 0:t.utilization_rate,0)})}},"CPU"),(0,Z.jsx)(xn,{title:h.formatMessage({id:"resources.table.memory"}),dataIndex:"memory",render:function(e,n){var t,r;return(0,Z.jsx)(I,{percent:jn(null==n||null===(t=n.status)||void 0===t||null===(t=t.memory)||void 0===t?void 0:t.used,null==n||null===(r=n.status)||void 0===r||null===(r=r.memory)||void 0===r?void 0:r.total),label:(0,Z.jsx)(C.Z,{fieldList:vn,data:n.status.memory})})}},"Memory"),(0,Z.jsx)(xn,{title:"GPU",dataIndex:"GPU",render:function(e,n){var t;return(0,Z.jsx)("span",{className:"flex-column flex-gap-2",children:F().map(F().sortBy((null==n||null===(t=n.status)||void 0===t?void 0:t.gpu_devices)||[],["index"]),(function(e,n){var t;return(0,Z.jsxs)("span",{className:"flex-center",children:[(0,Z.jsxs)("span",{className:"m-r-5",style:{display:"flex",width:25},children:["[",e.index,"]"]}),e.core?(0,Z.jsx)(I,{percent:F().round(null===(t=e.core)||void 0===t?void 0:t.utilization_rate,0)},n):"-"]},n)}))})}},"GPU"),(0,Z.jsx)(xn,{title:h.formatMessage({id:"resources.table.vram"}),dataIndex:"VRAM",render:function(e,n){var t;return(0,Z.jsx)("span",{className:"flex-column flex-gap-2",children:F().map(F().sortBy((null==n||null===(t=n.status)||void 0===t?void 0:t.gpu_devices)||[],["index"]),(function(e,n){var t,r,a,s;return(0,Z.jsx)("span",{children:(0,Z.jsxs)("span",{className:"flex-center",children:[(0,Z.jsxs)("span",{className:"m-r-5",style:{display:"flex",width:25},children:["[",e.index,"]"]}),(0,Z.jsx)(I,{percent:null!==(t=e.memory)&&void 0!==t&&t.used?F().round(null===(r=e.memory)||void 0===r?void 0:r.utilization_rate,0):F().round((null===(a=e.memory)||void 0===a?void 0:a.allocated)/(null===(s=e.memory)||void 0===s?void 0:s.total)*100,0),label:(0,Z.jsx)(C.Z,{fieldList:vn,data:e.memory})},n),e.memory.is_unified_memory&&(0,Z.jsx)(_.Z,{title:h.formatMessage({id:"resources.table.unified"}),children:(0,Z.jsx)(Me.Z,{className:"m-l-5",style:{color:"var(--ant-blue-5)"}})})]})},n)}))})}},"VRAM"),(0,Z.jsx)(xn,{title:h.formatMessage({id:"resources.table.disk"}),dataIndex:"storage",render:function(e,n){var t,r,a;return(0,Z.jsx)(I,{percent:(r=null===(t=n.status)||void 0===t?void 0:t.filesystem,a=F().find(r,(function(e){return"/"===e.mount_point})),a?jn(a.used,a.total):0),label:E(n.status.filesystem)})}},"storage"),(0,Z.jsx)(xn,{title:h.formatMessage({id:"common.table.operation"}),render:function(e,n){return(0,Z.jsx)($.Z,{items:bn,onSelect:function(e){return D(e,n)}})}},"operation")]})}),(0,Z.jsx)(U.Z,{ref:s}),(0,Z.jsx)(un,{open:g,onCancel:function(){return x(!1)}}),(0,Z.jsx)(gn,{open:M.open,onOk:G,onCancel:W,data:{name:M.data.name,labels:M.data.labels}})]})},kn=j.ZP.div(g||(g=o()(["\n  .ant-page-header-heading {\n    padding-inline: 8px;\n  }\n"]))),wn=function(){var e=c(),n=e.setTabActive,t=e.getTabActive,r=e.tabsMap,s=(0,b.useState)(t(r.resources)||"workers"),o=a()(s,2),l=o[0],i=o[1],d=(0,v.useIntl)(),u=[{key:"workers",label:"Workers",children:(0,Z.jsx)(yn,{})},{key:"gpus",label:"GPUs",children:(0,Z.jsx)(D,{})},{key:"model-files",label:d.formatMessage({id:"resources.modelfiles.modelfile"}),children:(0,Z.jsx)(Be,{})}],m=(0,b.useCallback)((function(e){i(e),n(r.resources,e)}),[]);return(0,Z.jsx)(kn,{children:(0,Z.jsx)(x._z,{ghost:!0,header:{title:d.formatMessage({id:"resources.title"}),style:{paddingInline:"var(--layout-content-inlinepadding)"}},tabList:u,onTabChange:m,tabActiveKey:l,tabProps:{type:"card",style:{marginTop:78}},extra:[]})})}}}]);