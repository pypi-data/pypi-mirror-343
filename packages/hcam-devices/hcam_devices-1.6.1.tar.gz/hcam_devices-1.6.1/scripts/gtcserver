#! /usr/bin/env python
import argparse
import os

from autobahn.twisted.component import Component, run

from hcam_devices.components import GTCComponent

URL = os.getenv("WAMP_SERVER", "192.168.1.2")

transport_cfg = dict(
    type="websocket",
    url="ws://{}:8080/ws".format(URL),
    max_retries=-1,
    max_retry_delay=30,
)


parser = argparse.ArgumentParser()
parser.add_argument("path", help="full path where FITS files of raw data are written")
parser.add_argument(
    "-e", "--emulate", help="use emulated hardware", action="store_true"
)
args = parser.parse_args()

gtc = Component(
    transports=transport_cfg,
    realm="realm1",
    session_factory=GTCComponent,
    extra=dict(name="GTC", emulate=args.emulate, path=args.path),
)

run([gtc])
