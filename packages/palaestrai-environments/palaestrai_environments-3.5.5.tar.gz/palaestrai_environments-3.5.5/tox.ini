[tox]
envlist = {py38,py39,py310}
skip_missing_interpreters=True


[cfg-black]
deps = black
commands =
    black --check -l 79 ./src/palaestrai ./tests

[cfg-mypy]
deps =  mypy
        lxml
        types-click
        types-pkg_resources
        types-mock
allowlist_externals=
    mkdir
commands =
    pip install .[dev]
    mkdir -p {toxinidir}/test_reports/mypy/
    mypy --junit-xml  {toxinidir}/test_reports/mypy/mypy.xml {toxinidir}/src {toxinidir}/tests

[cfg-unit-test]
deps =
    coverage
    pytest
    pytest-cov
    black
    robotframework
    types-click
    types-pkg_resources
    types-mock
    git+https://gitlab.com/arl2/palaestrai.git/@development#egg=palaestrai
allowlist_externals=
    mkdir
commands =
    python -m pip install -e .[dev]
    mkdir -p {toxinidir}/test_reports/
    pytest --cov={toxinidir}/src {toxinidir}/tests --junitxml={toxinidir}/test_reports/report.xml
    coverage xml -o {toxinidir}/test_reports/coverage.xml

[cfg-system]
deps =
    robotframework >= 4.0
commands =
    {envbindir}/robot --outputdir {toxinidir}/test_reports/system/{envname}/ tests/system
passenv = POSTGRES_*


[testenv]
deps =
    {[cfg-black]deps}
    {[cfg-mypy]deps}
    {[cfg-unit-test]deps}
    {[cfg-system]deps}
allowlist_externals=
    {[cfg-unit-test]allowlist_externals}
commands =
    {[cfg-black]commands}
    {[cfg-mypy]commands}
    {[cfg-unit-test]commands}
    {[cfg-system]commands}
passenv = {[cfg-system]passenv}

[testenv:black]
deps = {[cfg-black]deps}
commands = {[cfg-black]commands}

[testenv:mypy]
deps = {[cfg-mypy]deps}
allowlist_externals= {[cfg-mypy]allowlist_externals}
commands = {[cfg-mypy]commands}

[testenv:unit-test]
deps =
    {[cfg-unit-test]deps}
allowlist_externals=
    {[cfg-unit-test]allowlist_externals}
commands =
    {[cfg-unit-test]commands}

[testenv:system]
deps = {[cfg-system]deps}
commands =
    {[cfg-system]commands}
passenv = {[cfg-system]passenv}
