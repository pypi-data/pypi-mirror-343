var Gt=n=>{throw TypeError(n)};var Tt=(n,e,t)=>e.has(n)||Gt("Cannot "+t);var w=(n,e,t)=>(Tt(n,e,"read from private field"),t?t.call(n):e.get(n)),Be=(n,e,t)=>e.has(n)?Gt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),lt=(n,e,t,r)=>(Tt(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),st=(n,e,t)=>(Tt(n,e,"access private method"),t);import{l as ot,s as Ne,O as Ct,j as oa,Q as ia,k as Rt,a as ht,m as la,G as Ue,f as Ge,R as Nt,u as da,e as nt,i as _t,_ as ca,C as ua,U as va,b as fa,c as ga,V as ha,W as ma,X as _a,Y as pa,Z as xa,$ as qt,a0 as $a,a1 as Kt,d as Xt,a2 as ba,a3 as ya}from"../chunks/BAITReer.js";import{aC as Jt,g as dt,z as wa,p as K,a as J,f as x,x as Re,D as kt,k as a,v as A,m as E,c as f,r as c,t as U,s as u,A as se,q as Oe,w as Ze,aE as Yt,e as Sa}from"../chunks/Bj8SChEI.js";import{c as Ye,a as Pa}from"../chunks/BBLiiV7J.js";import{r as $t}from"../chunks/Cbydd1_z.js";import{r as Ta}from"../chunks/B90CZVMX.js";import{c as O,a as o,t as b,s as Q,b as we}from"../chunks/Bd4FQpE7.js";import{d as ze,r as pe,p as Pe,i as Se,c as le,s as vt,e as N,a as _e,b as bt}from"../chunks/ZhKyHBKW.js";import{p as Ca}from"../chunks/Bmd47mE_.js";import{S as Lt,a as St,f as ct,A as ka,T as Ea}from"../chunks/CE4fWPWB.js";import"../chunks/4LrpTdiC.js";import{p as Ia}from"../chunks/DZz--ybP.js";import{g as Fa,u as Aa,F as Et,S as It,a as Ft,G as At,b as Mt,R as Ot,c as Ma,D as Oa,d as Na}from"../chunks/CBV1bwXB.js";import{S as za,s as Da,h as Bt,n as Zt,a as ea,i as La,b as ja,u as jt,l as Ga}from"../chunks/BVhLpJTQ.js";import{L as Ra,a as ta}from"../chunks/DLa1pdXp.js";import{g as pt,u as qa}from"../chunks/YrmfYsvT.js";var et,tt,ye,Qe,Xe,xt,zt,Ut,Ka=(Ut=class extends za{constructor(e,t){super();Be(this,Xe);Be(this,et);Be(this,tt);Be(this,ye);Be(this,Qe);lt(this,et,e),this.setOptions(t),this.bindMethods(),st(this,Xe,xt).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var r;const t=this.options;this.options=w(this,et).defaultMutationOptions(e),Da(this.options,t)||w(this,et).getMutationCache().notify({type:"observerOptionsUpdated",mutation:w(this,ye),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&Bt(t.mutationKey)!==Bt(this.options.mutationKey)?this.reset():((r=w(this,ye))==null?void 0:r.state.status)==="pending"&&w(this,ye).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=w(this,ye))==null||e.removeObserver(this)}onMutationUpdate(e){st(this,Xe,xt).call(this),st(this,Xe,zt).call(this,e)}getCurrentResult(){return w(this,tt)}reset(){var e;(e=w(this,ye))==null||e.removeObserver(this),lt(this,ye,void 0),st(this,Xe,xt).call(this),st(this,Xe,zt).call(this)}mutate(e,t){var r;return lt(this,Qe,t),(r=w(this,ye))==null||r.removeObserver(this),lt(this,ye,w(this,et).getMutationCache().build(w(this,et),this.options)),w(this,ye).addObserver(this),w(this,ye).execute(e)}},et=new WeakMap,tt=new WeakMap,ye=new WeakMap,Qe=new WeakMap,Xe=new WeakSet,xt=function(){var t;const e=((t=w(this,ye))==null?void 0:t.state)??Fa();lt(this,tt,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},zt=function(e){Zt.batch(()=>{var t,r,s,l,i,d,m,$;if(w(this,Qe)&&this.hasListeners()){const S=w(this,tt).variables,h=w(this,tt).context;(e==null?void 0:e.type)==="success"?((r=(t=w(this,Qe)).onSuccess)==null||r.call(t,e.data,S,h),(l=(s=w(this,Qe)).onSettled)==null||l.call(s,e.data,null,S,h)):(e==null?void 0:e.type)==="error"&&((d=(i=w(this,Qe)).onError)==null||d.call(i,e.error,S,h),($=(m=w(this,Qe)).onSettled)==null||$.call(m,void 0,e.error,S,h))}this.listeners.forEach(S=>{S(w(this,tt))})})},Ut);function Ja(n,e){const t=ea(),r=La(n)?n:Jt(n),s=new Ka(t,dt(r));let l;r.subscribe(m=>{l=($,S)=>{s.mutate($,S).catch(ja)},s.setOptions(m)});const i=Jt(s.getCurrentResult(),m=>s.subscribe(Zt.batchCalls($=>m($)))),{subscribe:d}=wa(i,m=>({...m,mutate:l,mutateAsync:m.mutate}));return{subscribe:d}}function aa(n,e){K(e,!0);let t=pe(e,["$$slots","$$events","$$legacy"]);ot(n,ze({name:"image"},()=>t,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(s,l)=>{var i=O(),d=x(i);Ne(d,()=>e.children??Re),o(s,i)},$$slots:{default:!0}})),J()}function Ba(n,e){K(e,!0);let t=pe(e,["$$slots","$$events","$$legacy"]);ot(n,ze({name:"component"},()=>t,{iconNode:[["path",{d:"M15.536 11.293a1 1 0 0 0 0 1.414l2.376 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z"}],["path",{d:"M2.297 11.293a1 1 0 0 0 0 1.414l2.377 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414L6.088 8.916a1 1 0 0 0-1.414 0z"}],["path",{d:"M8.916 17.912a1 1 0 0 0 0 1.415l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.415l-2.377-2.376a1 1 0 0 0-1.414 0z"}],["path",{d:"M8.916 4.674a1 1 0 0 0 0 1.414l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z"}]],children:(s,l)=>{var i=O(),d=x(i);Ne(d,()=>e.children??Re),o(s,i)},$$slots:{default:!0}})),J()}var Va=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Wa=["difference","intersection","symmetricDifference","union"],Vt=!1,ut,je,at,yt,ra;const wt=class wt extends Set{constructor(t){super();Be(this,yt);Be(this,ut,new Map);Be(this,je,kt(0));Be(this,at,kt(0));if(t){for(var r of t)super.add(r);w(this,at).v=super.size}Vt||st(this,yt,ra).call(this)}has(t){var r=super.has(t),s=w(this,ut),l=s.get(t);if(l===void 0){if(!r)return a(w(this,je)),!1;l=kt(!0),s.set(t,l)}return a(l),r}add(t){return super.has(t)||(super.add(t),A(w(this,at),super.size),Ct(w(this,je))),this}delete(t){var r=super.delete(t),s=w(this,ut),l=s.get(t);return l!==void 0&&(s.delete(t),A(l,!1)),r&&(A(w(this,at),super.size),Ct(w(this,je))),r}clear(){if(super.size!==0){super.clear();var t=w(this,ut);for(var r of t.values())A(r,!1);t.clear(),A(w(this,at),0),Ct(w(this,je))}}keys(){return this.values()}values(){return a(w(this,je)),super.values()}entries(){return a(w(this,je)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return a(w(this,at))}};ut=new WeakMap,je=new WeakMap,at=new WeakMap,yt=new WeakSet,ra=function(){Vt=!0;var t=wt.prototype,r=Set.prototype;for(const s of Va)t[s]=function(...l){return a(w(this,je)),r[s].apply(this,l)};for(const s of Wa)t[s]=function(...l){a(w(this,je));var i=r[s].apply(this,l);return new wt(i)}};let Dt=wt;var Ha=b("<div><!></div>");function Qa(n,e){K(e,!0);let t=Pe(e,"id",19,oa),r=Pe(e,"ref",15,null),s=pe(e,["$$slots","$$events","$$legacy","id","children","child","ref"]);const l=ia({id:Rt.with(()=>t()),ref:Rt.with(()=>r(),h=>r(h))}),i=E(()=>la(s,l.props));var d=O(),m=x(d);{var $=h=>{var I=O(),_=x(I);Ne(_,()=>e.child,()=>({props:a(i)})),o(h,I)},S=h=>{var I=Ha();let _;var T=f(I);Ne(T,()=>e.children??Re),c(I),U(()=>_=ht(I,_,{...a(i)})),o(h,I)};Se(m,h=>{e.child?h($):h(S,!1)})}o(n,d),J()}var Ua=b("<!> Samples",1),Xa=b("<!> Annotations",1),Ya=b('<div class="mb-5 mt-2 text-lg font-semibold">Collections</div> <!> <div class="flex space-x-2"><!> <!></div>',1);function Za(n,e){K(e,!0);var t=Ya(),r=u(x(t),2);Lt(r,{class:"mb-4 bg-border-hard"});var s=u(r,2),l=f(s);const i=E(()=>Ge("flex-1","px-2",e.gridType=="samples"&&"inline-flex rounded-md bg-muted")),d=E(()=>$t.toSamples(e.datasetId));Ue(l,{variant:"ghost",get class(){return a(i)},get href(){return a(d)},"data-sveltekit-noscroll":!0,children:(h,I)=>{var _=Ua(),T=x(_);aa(T,{class:"size-4"}),se(),o(h,_)},$$slots:{default:!0}});var m=u(l,2);const $=E(()=>Ge("flex-1","px-2",e.gridType=="annotations"&&"inline-flex rounded-md bg-muted")),S=E(()=>$t.toAnnotations(e.datasetId));Ue(m,{get class(){return a($)},variant:"ghost",get href(){return a(S)},"data-sveltekit-noscroll":!0,children:(h,I)=>{var _=Xa(),T=x(_);Ba(T,{class:"size-4"}),se(),o(h,_)},$$slots:{default:!0}}),c(s),o(n,t),J()}var er=b('<div class="space-y-4"><div class="space-y-1"><h2 class="text-md">Width Filter</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div> <div class="space-y-1"><h2 class="text-md">Height Filter</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div></div>');function tr(n,e){K(e,!0);const[t,r]=vt(),s=()=>le(e.dimensions,"$dimensions",t),{min_width:l,max_width:i,min_height:d,max_height:m}=s(),$=h=>{e.onChange({min_width:h[0],max_width:h[1],min_height:d,max_height:m})},S=h=>{e.onChange({min_width:l,max_width:i,min_height:h[0],max_height:h[1]})};St(n,{title:"Metadata",children:(h,I)=>{var _=er(),T=f(_),p=u(f(T),2),g=f(p),C=f(g);c(g);var v=u(g,2),B=f(v);c(v),c(p);var M=u(p,2),k=f(M);Nt(k,{type:"multiple",class:"filter-width",min:l,max:i,value:[l,i],onValueChange:$}),c(M),c(T);var Te=u(T,2),Ce=u(f(Te),2),V=f(Ce),z=f(V);c(V);var W=u(V,2),Me=f(W);c(W),c(Ce);var De=u(Ce,2),qe=f(De);Nt(qe,{type:"multiple",class:"filter-height",min:d,max:m,value:[d,m],onValueChange:S}),c(De),c(Te),c(_),U((xe,Ve,ue,Z)=>{Q(C,`${xe??""}px`),Q(B,`${Ve??""}px`),Q(z,`${ue??""}px`),Q(Me,`${Z??""}px`)},[()=>ct(s().min_width),()=>ct(s().max_width),()=>ct(s().min_height),()=>ct(s().max_height)]),o(h,_)},$$slots:{default:!0}}),J(),r()}function ar(n,e){K(e,!0);let t=pe(e,["$$slots","$$events","$$legacy"]);ot(n,ze({name:"eraser"},()=>t,{iconNode:[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]],children:(s,l)=>{var i=O(),d=x(i);Ne(d,()=>e.children??Re),o(s,i)},$$slots:{default:!0}})),J()}function rr(n,e){K(e,!0);let t=pe(e,["$$slots","$$events","$$legacy"]);ot(n,ze({name:"grid-3x3"},()=>t,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}],["path",{d:"M3 9h18"}],["path",{d:"M3 15h18"}],["path",{d:"M9 3v18"}],["path",{d:"M15 3v18"}]],children:(s,l)=>{var i=O(),d=x(i);Ne(d,()=>e.children??Re),o(s,i)},$$slots:{default:!0}})),J()}function sr(n,e){K(e,!0);let t=pe(e,["$$slots","$$events","$$legacy"]);ot(n,ze({name:"plus"},()=>t,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(s,l)=>{var i=O(),d=x(i);Ne(d,()=>e.children??Re),o(s,i)},$$slots:{default:!0}})),J()}function nr(n,e){K(e,!0);let t=pe(e,["$$slots","$$events","$$legacy"]);ot(n,ze({name:"search"},()=>t,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(s,l)=>{var i=O(),d=x(i);Ne(d,()=>e.children??Re),o(s,i)},$$slots:{default:!0}})),J()}function or(n,e){K(e,!0);let t=pe(e,["$$slots","$$events","$$legacy"]);ot(n,ze({name:"sliders-horizontal"},()=>t,{iconNode:[["line",{x1:"21",x2:"14",y1:"4",y2:"4"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22"}]],children:(s,l)=>{var i=O(),d=x(i);Ne(d,()=>e.children??Re),o(s,i)},$$slots:{default:!0}})),J()}const ir=async n=>{const e={data:{},error:void 0};try{const t=await Ye.POST("/api/metrics/compute/detection/map",{body:n});if(t.error)throw new Error(JSON.stringify(t.error,null,2));if(!t.data)throw new Error("No data returned from metrics calculation");e.data=t.data}catch(t){e.error="Error computing metrics: "+String(t)}return e};var lr=b("<!> <!>",1),dr=b("<!> <!>",1),cr=b("<!> <!>",1),ur=b("<!> <!>",1),vr=b('<div class="rounded-md bg-destructive/15 p-3 text-sm text-destructive"> </div>'),fr=b('<span class="mr-2 animate-spin">‚ü≥</span>'),gr=b("<!> Compute",1),hr=b('<div class="space-y-6"><!> <!> <!> <!> <div class="flex space-x-2"><!> <!></div></div>'),mr=b('<div class="flex justify-between"><span class="truncate"> </span> <span class="font-medium"> </span></div>'),_r=b('<div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP by Class</h4> <div class="max-h-60 space-y-1 overflow-y-auto text-sm"></div></div>'),pr=b('<div class="space-y-4"><div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP Results</h4> <div class="space-y-2 text-sm"><div class="flex justify-between"><span>mAP:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@50:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@75:</span> <span class="font-medium"> </span></div></div></div> <!> <!></div>'),xr=b('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 text-lg font-semibold">Metrics</div> <!> <div class="flex-1 space-y-6"><!></div></div>'),$r=b('<div class="hidden"></div>');function br(n,e){K(e,!0);const[t,r]=vt(),s=()=>le(I,"$isMetricsPanelOpen",t),l=()=>le(h,"$hasEnoughTasksForMetrics",t),i=()=>le(S,"$annotationTasks",t),d=()=>le($,"$tags",t);let m=Ia.params.dataset_id;const{tags:$}=jt({dataset_id:m}),{annotationTasks:S,hasEnoughTasksForMetrics:h}=da(),{isMetricsPanelOpen:I}=Aa();let _=Oe(""),T=Oe(""),p=Oe(""),g=Oe(null),C=Oe(!1),v=Oe("");async function B(){if(!a(_)||!a(T)){A(v,"Please select both ground truth and prediction tasks");return}A(C,!0),A(v,"");try{const z=await ir({dataset_id:m,ground_truth_task_id:a(_),prediction_task_id:a(T),tag_id:a(p)||null});z.error?A(v,_e(z.error)):A(g,_e(z.data))}catch(z){A(v,_e(String(z)))}finally{A(C,!1)}}function M(){A(_,""),A(T,""),A(p,""),A(g,null),A(v,"")}var k=O(),Te=x(k);{var Ce=z=>{var W=xr(),Me=u(f(W),2);Lt(Me,{class:"mb-4 bg-border-hard"});var De=u(Me,2),qe=f(De);{var xe=ue=>{var Z=hr(),ge=f(Z);Et(ge,{label:"Ground Truth Task",children:(L,ee)=>{var P=O(),te=x(P);N(te,()=>Ot,(ne,R)=>{R(ne,{type:"single",name:"groundTruthTaskId",get value(){return a(_)},set value(D){A(_,_e(D))},children:(D,be)=>{var Y=lr(),ve=x(Y);N(ve,()=>It,(me,ae)=>{ae(me,{class:"w-full",children:(oe,He)=>{se();var H=we();U(j=>Q(H,j),[()=>{var j;return((j=i().find(F=>F.annotation_task_id===a(_)))==null?void 0:j.name)||"Select ground truth task"}]),o(oe,H)},$$slots:{default:!0}})});var Le=u(ve,2);N(Le,()=>Ft,(me,ae)=>{ae(me,{children:(oe,He)=>{var H=O(),j=x(H);N(j,()=>At,(F,ie)=>{ie(F,{children:(fe,Ke)=>{var re=O(),Ie=x(re);nt(Ie,1,()=>i().filter(Fe=>!Fe.is_prediction),_t,(Fe,q)=>{var de=O(),Ae=x(de);{var Je=ce=>{var rt=O(),ft=x(rt);N(ft,()=>Mt,(mt,it)=>{it(mt,{get value(){return a(q).annotation_task_id},get label(){return a(q).name},children:(Pt,na)=>{se();var gt=we();U(()=>Q(gt,a(q).name)),o(Pt,gt)},$$slots:{default:!0}})}),o(ce,rt)};Se(Ae,ce=>{a(q).annotation_task_id&&ce(Je)})}o(Fe,de)}),o(fe,re)},$$slots:{default:!0}})}),o(oe,H)},$$slots:{default:!0}})}),o(D,Y)},$$slots:{default:!0}})}),o(L,P)}});var ke=u(ge,2);Et(ke,{label:"Prediction Task",children:(L,ee)=>{var P=O(),te=x(P);N(te,()=>Ot,(ne,R)=>{R(ne,{type:"single",name:"predictionTaskId",get value(){return a(T)},set value(D){A(T,_e(D))},children:(D,be)=>{var Y=dr(),ve=x(Y);N(ve,()=>It,(me,ae)=>{ae(me,{class:"w-full",children:(oe,He)=>{se();var H=we();U(j=>Q(H,j),[()=>{var j;return((j=i().find(F=>F.annotation_task_id===a(T)))==null?void 0:j.name)||"Select prediction task"}]),o(oe,H)},$$slots:{default:!0}})});var Le=u(ve,2);N(Le,()=>Ft,(me,ae)=>{ae(me,{children:(oe,He)=>{var H=O(),j=x(H);N(j,()=>At,(F,ie)=>{ie(F,{children:(fe,Ke)=>{var re=O(),Ie=x(re);nt(Ie,1,()=>i().filter(Fe=>Fe.is_prediction),_t,(Fe,q)=>{var de=O(),Ae=x(de);{var Je=ce=>{var rt=O(),ft=x(rt);N(ft,()=>Mt,(mt,it)=>{it(mt,{get value(){return a(q).annotation_task_id},get label(){return a(q).name},children:(Pt,na)=>{se();var gt=we();U(()=>Q(gt,a(q).name)),o(Pt,gt)},$$slots:{default:!0}})}),o(ce,rt)};Se(Ae,ce=>{a(q).annotation_task_id&&ce(Je)})}o(Fe,de)}),o(fe,re)},$$slots:{default:!0}})}),o(oe,H)},$$slots:{default:!0}})}),o(D,Y)},$$slots:{default:!0}})}),o(L,P)}});var $e=u(ke,2);Et($e,{label:"Tag (Optional)",children:(L,ee)=>{var P=O(),te=x(P);N(te,()=>Ot,(ne,R)=>{R(ne,{type:"single",name:"tagId",get value(){return a(p)},set value(D){A(p,_e(D))},children:(D,be)=>{var Y=ur(),ve=x(Y);N(ve,()=>It,(me,ae)=>{ae(me,{class:"w-full",children:(oe,He)=>{se();var H=we();U(j=>Q(H,j),[()=>{var j;return((j=d().find(F=>F.tag_id===a(p)))==null?void 0:j.name)||"Select tag (optional)"}]),o(oe,H)},$$slots:{default:!0}})});var Le=u(ve,2);N(Le,()=>Ft,(me,ae)=>{ae(me,{children:(oe,He)=>{var H=O(),j=x(H);N(j,()=>At,(F,ie)=>{ie(F,{children:(fe,Ke)=>{var re=cr(),Ie=x(re);N(Ie,()=>Ma,(q,de)=>{de(q,{children:(Ae,Je)=>{se();var ce=we("Sample tags");o(Ae,ce)},$$slots:{default:!0}})});var Fe=u(Ie,2);nt(Fe,1,()=>d().filter(q=>q.kind==="sample"),_t,(q,de)=>{var Ae=O(),Je=x(Ae);N(Je,()=>Mt,(ce,rt)=>{rt(ce,{get value(){return a(de).tag_id},get label(){return a(de).name},children:(ft,mt)=>{se();var it=we();U(()=>Q(it,a(de).name)),o(ft,it)},$$slots:{default:!0}})}),o(q,Ae)}),o(fe,re)},$$slots:{default:!0}})}),o(oe,H)},$$slots:{default:!0}})}),o(D,Y)},$$slots:{default:!0}})}),o(L,P)}});var Ee=u($e,2);{var We=L=>{var ee=vr(),P=f(ee,!0);c(ee),U(()=>Q(P,a(v))),o(L,ee)};Se(Ee,L=>{a(v)&&L(We)})}var y=u(Ee,2),G=f(y);Ue(G,{variant:"outline",class:"flex-1",onclick:M,get disabled(){return a(C)},children:(L,ee)=>{se();var P=we("Reset");o(L,P)},$$slots:{default:!0}});var X=u(G,2);const he=E(()=>!a(_)||!a(T)||a(C));Ue(X,{variant:"default",class:"flex-1",onclick:B,get disabled(){return a(he)},children:(L,ee)=>{var P=gr(),te=x(P);{var ne=R=>{var D=fr();o(R,D)};Se(te,R=>{a(C)&&R(ne)})}se(),o(L,P)},$$slots:{default:!0}}),c(y),c(Z),o(ue,Z)},Ve=ue=>{var Z=pr(),ge=f(Z),ke=u(f(ge),2),$e=f(ke),Ee=u(f($e),2),We=f(Ee);c(Ee),c($e);var y=u($e,2),G=u(f(y),2),X=f(G);c(G),c(y);var he=u(y,2),L=u(f(he),2),ee=f(L);c(L),c(he),c(ke),c(ge);var P=u(ge,2);{var te=R=>{var D=_r(),be=u(f(D),2);nt(be,21,()=>Object.entries(a(g).map_per_class).sort(([Y],[ve])=>Y<ve?-1:Y>ve?1:0),_t,(Y,ve)=>{let Le=()=>a(ve)[0],me=()=>a(ve)[1];var ae=mr(),oe=f(ae),He=f(oe);c(oe);var H=u(oe,2),j=f(H);c(H),c(ae),U(F=>{Q(He,`${Le()??""}:`),Q(j,`${F??""}%`)},[()=>(me()*100).toFixed(2)]),o(Y,ae)}),c(be),c(D),o(R,D)};Se(P,R=>{a(g).map_per_class&&R(te)})}var ne=u(P,2);Ue(ne,{variant:"outline",class:"mt-4 w-full",onclick:()=>A(g,null),children:(R,D)=>{se();var be=we("Back to Form");o(R,be)},$$slots:{default:!0}}),c(Z),U((R,D,be)=>{Q(We,`${R??""}%`),Q(X,`${D??""}%`),Q(ee,`${be??""}%`)},[()=>(a(g).map*100).toFixed(2),()=>(a(g).map_50*100).toFixed(2),()=>(a(g).map_75*100).toFixed(2)]),o(ue,Z)};Se(qe,ue=>{a(g)?ue(Ve,!1):ue(xe)})}c(De),c(W),o(z,W)},V=z=>{var W=$r();o(z,W)};Se(Te,z=>{s()&&l()?z(Ce):z(V,!1)})}o(n,k),J(),r()}var yr=b('<div class="w-300 flex space-x-4 text-diffuse-foreground"><!> <!> <!></div>');function wr(n,e){K(e,!0);const t=Pe(e,"min",3,100),r=Pe(e,"max",3,1500),s=ca.throttle(S=>{e.onChange(S[0])},100);var l=yr(),i=f(l);rr(i,{class:"h-6 w-6"});var d=u(i,2);const m=E(()=>[e.width]);Nt(d,{class:"w-full flex-1",get value(){return a(m)},get min(){return t()},get max(){return r()},step:1,onValueChange:s});var $=u(d,2);aa($,{class:"h-6 w-6"}),c(l),o(n,l),J()}var Sr=b('<div class="h-3 w-3 cursor-pointer rounded-sm border"></div>'),Pr=b('<div class="color-picker-container"><!></div> <p class="flex-1 truncate text-base font-normal"> </p> <span class="text-sm text-diffuse-foreground"> </span>',1),Tr=b('<div class="width-full flex items-center space-x-2"><!> <!></div>'),Cr=b('<div class="width-full space-y-2 overflow-hidden"></div>');function kr(n,e){K(e,!0);const[t,r]=vt(),s=()=>le(S,"$customLabelColorsStore",t),l=()=>le(i(),"$annotationFilters",t);let i=Pe(e,"annotationFilters",19,()=>[]);const{setCustomColor:d,getCustomColor:m,hasCustomColor:$,customLabelColorsStore:S}=qa();function h(g,C,v){d(g,C,v)}function I(g){if($(g)){const v=m(g);return(v==null?void 0:v.color)||"#ff0000"}const C=pt(g,1).color;try{const v=C.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(v){const B=parseInt(v[1]),M=parseInt(v[2]),k=parseInt(v[3]);return`#${((1<<24)+(B<<16)+(M<<8)+k).toString(16).slice(1)}`}}catch(v){console.error("Error converting rgba to hex",v)}return"#ff0000"}function _(g){if($(g)){const C=m(g);return(C==null?void 0:C.alpha)||1}return .4}function T(g,C){const v=g.target;(v.tagName==="P"||v.tagName==="SPAN"||v===g.currentTarget)&&e.onToggleAnnotationFilter(C)}const p=E(()=>{const g=s(),C={};for(const v of Object.keys(g)){const B=g[v];C[v]={borderColor:B.color,backgroundColor:pt(v,.4).color}}return C});St(n,{title:"Labels",children:(g,C)=>{var v=Cr();nt(v,5,l,({label_name:B,current_count:M,total_count:k,selected:Te})=>B,(B,M)=>{let k=()=>a(M).label_name,Te=()=>a(M).current_count,Ce=()=>a(M).total_count,V=()=>a(M).selected;var z=Tr(),W=f(z);const Me=E(()=>`${k()}-label`);ua(W,{get id(){return k()},get checked(){return V()},get"aria-labelledby"(){return a(Me)},onCheckedChange:()=>e.onToggleAnnotationFilter(k())});var De=u(W,2);const qe=E(()=>`${k()}-label`);Ra(De,{get id(){return a(qe)},get for(){return k()},class:"flex min-w-0 flex-1 cursor-pointer items-center space-x-2 text-nowrap peer-disabled:cursor-not-allowed peer-disabled:opacity-70",onclick:xe=>T(xe,k()),children:(xe,Ve)=>{var ue=Pr(),Z=x(ue),ge=f(Z);const ke=E(()=>I(k())),$e=E(()=>_(k()));va(ge,{get initialColor(){return a(ke)},get initialAlpha(){return a($e)},onChange:(X,he)=>h(k(),X,he),children:(X,he)=>{var L=Sr();U(ee=>fa(L,ee),[()=>{var ee,P;return`
                                    border-color: ${((ee=a(p)[k()])==null?void 0:ee.borderColor)??pt(k()).color};
                                    background-color: ${((P=a(p)[k()])==null?void 0:P.backgroundColor)??pt(k(),V()?1:.4).color};
                                `}]),o(X,L)},$$slots:{default:!0}}),c(Z);var Ee=u(Z,2),We=f(Ee,!0);c(Ee);var y=u(Ee,2),G=f(y);c(y),U((X,he)=>{Q(We,k()),Q(G,`${X??""} of ${he??""}`)},[()=>ct(Te()),()=>ct(Ce())]),o(xe,ue)},$$slots:{default:!0}}),c(z),U(()=>ga(z,"title",k())),o(B,z)}),c(v),o(g,v)},$$slots:{default:!0}}),J(),r()}function Er(n,e){K(e,!0);let t=Pe(e,"ref",15,null),r=pe(e,["$$slots","$$events","$$legacy","ref","class"]);var s=O(),l=x(s);const i=E(()=>Ge("text-lg font-semibold leading-none tracking-tight",e.class));N(l,()=>Oa,(d,m)=>{m(d,ze({get class(){return a(i)}},()=>r,{get ref(){return t()},set ref($){t($)}}))}),o(n,s),J()}var Ir=b("<div><!></div>");function Fr(n,e){K(e,!0);let t=Pe(e,"ref",15,null),r=pe(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=Ir();let l;var i=f(s);Ne(i,()=>e.children??Re),c(s),bt(s,d=>t(d),()=>t()),U(d=>l=ht(s,l,{class:d,...r}),[()=>Ge("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e.class)]),o(n,s),J()}var Ar=b("<div><!></div>");function Mr(n,e){K(e,!0);let t=Pe(e,"ref",15,null),r=pe(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=Ar();let l;var i=f(s);Ne(i,()=>e.children??Re),c(s),bt(s,d=>t(d),()=>t()),U(d=>l=ht(s,l,{class:d,...r}),[()=>Ge("flex flex-col space-y-1.5 text-center sm:text-left",e.class)]),o(n,s),J()}function Or(n,e){K(e,!0);let t=Pe(e,"ref",15,null),r=pe(e,["$$slots","$$events","$$legacy","ref","class"]);var s=O(),l=x(s);const i=E(()=>Ge("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0  fixed inset-0 z-50 bg-black/80",e.class));N(l,()=>ha,(d,m)=>{m(d,ze({get class(){return a(i)}},()=>r,{get ref(){return t()},set ref($){t($)}}))}),o(n,s),J()}var Nr=b('<!> <span class="sr-only">Close</span>',1),zr=b("<!> <!>",1),Dr=b("<!> <!>",1);function Lr(n,e){K(e,!0);let t=Pe(e,"ref",15,null),r=pe(e,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var s=O(),l=x(s);N(l,()=>Rr,(i,d)=>{d(i,ze(()=>e.portalProps,{children:(m,$)=>{var S=Dr(),h=x(S);N(h,()=>Or,(T,p)=>{p(T,{})});var I=u(h,2);const _=E(()=>Ge("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] bg-background fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 sm:rounded-lg",e.class));N(I,()=>ma,(T,p)=>{p(T,ze({get class(){return a(_)}},()=>r,{get ref(){return t()},set ref(g){t(g)},children:(g,C)=>{var v=zr(),B=x(v);Ne(B,()=>e.children??Re);var M=u(B,2);N(M,()=>_a,(k,Te)=>{Te(k,{class:"ring-offset-background focus:ring-ring absolute right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none",children:(Ce,V)=>{var z=Nr(),W=x(z);pa(W,{class:"size-4"}),se(2),o(Ce,z)},$$slots:{default:!0}})}),o(g,v)},$$slots:{default:!0}}))}),o(m,S)},$$slots:{default:!0}}))}),o(n,s),J()}function jr(n,e){K(e,!0);let t=Pe(e,"ref",15,null),r=pe(e,["$$slots","$$events","$$legacy","ref","class"]);var s=O(),l=x(s);const i=E(()=>Ge("text-muted-foreground text-sm",e.class));N(l,()=>Qa,(d,m)=>{m(d,ze({get class(){return a(i)}},()=>r,{get ref(){return t()},set ref($){t($)}}))}),o(n,s),J()}const Gr=Na,Rr=xa,qr=async({dataset_id:n,tag_id:e,annotationIdsBody:t})=>{const r={data:void 0,error:void 0};try{const s=await Ye.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/annotations",{params:{path:{dataset_id:n,tag_id:e}},body:t});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No data");r.data=s.data}catch(s){r.error="Error assigning annotationIds to a tag: "+String(s)}return r};var Kr=b("<input>"),Jr=b("<input>");function sa(n,e){K(e,!0);let t=Pe(e,"ref",15,null),r=Pe(e,"value",15),s=Pe(e,"files",15),l=pe(e,["$$slots","$$events","$$legacy","ref","value","type","files","class"]);var i=O(),d=x(i);{var m=S=>{var h=Kr();qt(h);let I;bt(h,_=>t(_),()=>t()),U(_=>I=ht(h,I,{class:_,type:"file",...l}),[()=>Ge("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),$a(h,s),Kt(h,r),o(S,h)},$=S=>{var h=Jr();qt(h);let I;bt(h,_=>t(_),()=>t()),U(_=>I=ht(h,I,{class:_,type:e.type,...l}),[()=>Ge("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),Kt(h,r),o(S,h)};Se(d,S=>{e.type==="file"?S(m):S($,!1)})}o(n,i),J()}const Br=async({dataset_id:n,tag_id:e,sampleIdsBody:t})=>{const r={data:void 0,error:void 0};try{const s=await Ye.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/samples",{params:{path:{dataset_id:n,tag_id:e}},body:t});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No data");r.data=s.data}catch(s){r.error="Error assigning sampleIds to tag: "+String(s)}return r},Vr=async({dataset_id:n,tagInputBody:e})=>{const t={data:void 0,error:void 0};try{const r=await Ye.POST("/api/datasets/{dataset_id}/tags",{params:{path:{dataset_id:n}},body:e});if(r.error)throw new Error(JSON.stringify(r.error,null,2));if(!r.data)throw new Error("No data");t.data=r.data}catch(r){t.error="Error creating tag: "+String(r)}return t};var Wr=b("<!> Create new Tags",1),Hr=b("<!> <!>",1),Qr=b('<div class="flex space-x-2 py-1"><!></div>'),Ur=b('<!> <!> <div class="grid gap-4"><!></div> <div><!> <!></div> <!>',1),Xr=b('<div class="flex space-x-1"><!> <!></div> <!>',1);function Yr(n,e){K(e,!0);const[t,r]=vt(),s=()=>le(I,"$selectedSampleIds",t),l=()=>le(_,"$selectedSampleAnnotationCropIds",t),i=()=>le(a(h),"$tags",t),d=()=>le(a(C),"$itemsSelected",t),m=()=>le(qe,"$submitTagAndMutate",t);let $=E(()=>e.gridType==="samples"?"sample":"annotation");const S=E(()=>jt({dataset_id:e.datasetId,kind:[a($)]})),h=E(()=>a(S).tags),{selectedSampleIds:I,selectedSampleAnnotationCropIds:_,clearSelectedSampleAnnotationCrops:T,clearSelectedSamples:p}=Xt(),g=E(()=>e.gridType==="samples"?p:T),C=E(()=>e.gridType==="samples"?I:_);let v=Oe(!1);const B=E(()=>s().size>0&&e.gridType==="samples"||l().size>0&&e.gridType==="annotations");let M=Oe(""),k=Oe(_e([])),Te=()=>{a(k).push(a(M)),V.add(a(M)),A(M,"")};const Ce=E(()=>[...a(k).map(y=>({tag_id:y,name:y,kind:a($)})),...i()].filter(y=>y.name.includes(a(M))));let V=_e(new Dt);const z=y=>{V.has(y)?(V.delete(y),a(k).splice(a(k).indexOf(y),1)):V.add(y)};let W=Oe(null);const Me=async()=>{await Promise.all([...a(k)].map(async y=>{var X;const G=await Vr({dataset_id:e.datasetId,tagInputBody:{name:y,description:`${y} description`,kind:a($)}});if(G.error)throw G.error;return(X=G.data)!=null&&X.tag_id&&(V.delete(y),V.add(G.data.tag_id)),G})),await Promise.all([...V].map(async y=>{const G=a($)==="sample"?await Br({dataset_id:e.datasetId,tag_id:y,sampleIdsBody:{sample_ids:[...d()]}}):await qr({dataset_id:e.datasetId,tag_id:y,annotationIdsBody:{annotation_ids:[...d()]}});if(G.error)throw G.error;return G}))},De=ea(),qe=Ja({mutationFn:async()=>{await Me()},onError:y=>{A(W,_e(y))},onSuccess:()=>{De.invalidateQueries({queryKey:Ga({dataset_id:e.datasetId})}),a(g)(),xe(!1)}}),xe=y=>{A(v,_e(y)),A(W,null),A(M,""),A(k,_e([])),V.clear()},Ve=E(()=>V.size>0||a(k).length>0);var ue=Xr(),Z=x(ue),ge=f(Z);const ke=E(()=>!a(B));Ue(ge,{variant:"outline",get disabled(){return a(ke)},class:"flex-1",onclick:()=>A(v,!0),children:(y,G)=>{var X=Wr(),he=x(X);sr(he,{}),se(),o(y,X)},$$slots:{default:!0}});var $e=u(ge,2);const Ee=E(()=>!a(B));Ue($e,{variant:"outline",get disabled(){return a(Ee)},size:"icon",title:"Clear selection",get onclick(){return a(g)},children:(y,G)=>{ar(y,{})},$$slots:{default:!0}}),c(Z);var We=u(Z,2);N(We,()=>Gr,(y,G)=>{G(y,{onOpenChange:xe,get open(){return a(v)},children:(X,he)=>{var L=O(),ee=x(L);N(ee,()=>Lr,(P,te)=>{te(P,{class:"sm:max-w-[425px]",children:(ne,R)=>{var D=Ur(),be=x(D);N(be,()=>Mr,(F,ie)=>{ie(F,{children:(fe,Ke)=>{var re=Hr(),Ie=x(re);N(Ie,()=>Er,(q,de)=>{de(q,{children:(Ae,Je)=>{se();var ce=we();U(()=>Q(ce,`Add the selected ${a($)??""} to a tag`)),o(Ae,ce)},$$slots:{default:!0}})});var Fe=u(Ie,2);N(Fe,()=>jr,(q,de)=>{de(q,{children:(Ae,Je)=>{se();var ce=we();U(()=>Q(ce,`Add the selected ${d().size??""}
                ${a($)??""} to an new or existing tag. Tags can later be exported.`)),o(Ae,ce)},$$slots:{default:!0}})}),o(fe,re)},$$slots:{default:!0}})});var Y=u(be,2);{var ve=F=>{ka(F,{title:"Error occured",children:(ie,fe)=>{se();var Ke=we();U(()=>Q(Ke,a(W))),o(ie,Ke)}})};Se(Y,F=>{a(W)&&F(ve)})}var Le=u(Y,2),me=f(Le);sa(me,{type:"text",placeholder:"Create or search tags",autofocus:!0,get value(){return a(M)},set value(F){A(M,_e(F))}}),c(Le);var ae=u(Le,2),oe=f(ae);nt(oe,17,()=>a(Ce),F=>F.tag_id,(F,ie)=>{var fe=Qr(),Ke=f(fe);const re=E(()=>`tagCreateDialog-tag-${a(ie).tag_id}`),Ie=E(()=>V.has(a(ie).tag_id));ta(Ke,{get name(){return a(re)},get isChecked(){return a(Ie)},get label(){return a(ie).name},onCheckedChange:()=>z(a(ie).tag_id)}),c(fe),o(F,fe)});var He=u(oe,2);{var H=F=>{const ie=E(()=>Ge("",...ba({variant:"outline"})));Ue(F,{type:"button",variant:"outline",get class(){return a(ie)},onclick:Te,children:(fe,Ke)=>{se();var re=we();U(()=>Q(re,`Create tag "${a(M)??""}"`)),o(fe,re)},$$slots:{default:!0}})};Se(He,F=>{a(M)&&F(H)})}c(ae);var j=u(ae,2);N(j,()=>Fr,(F,ie)=>{ie(F,{children:(fe,Ke)=>{var re=O(),Ie=x(re);{var Fe=q=>{Ue(q,{type:"submit",onclick:()=>m().mutate(),children:(de,Ae)=>{se();var Je=we("Save changes");o(de,Je)},$$slots:{default:!0}})};Se(Ie,q=>{a(Ve)&&q(Fe)})}o(fe,re)},$$slots:{default:!0}})}),o(ne,D)},$$slots:{default:!0}})}),o(X,L)},$$slots:{default:!0}})}),o(n,ue),J(),r()}var Zr=b('<div class="flex items-center space-x-2 py-1"><!></div>'),es=b("<p>No tag, create a tag</p>"),ts=b('<div class="mb-3 w-full space-y-2"></div>');function as(n,e){K(e,!0);const[t,r]=vt(),s=()=>le(a(d),"$tags",t),l=()=>le(a(m),"$tagsSelected",t),i=E(()=>jt({dataset_id:e.dataset_id,kind:[e.gridType==="annotations"?"annotation":"sample"]})),d=E(()=>a(i).tags),m=E(()=>a(i).tagsSelected),$=E(()=>a(i).tagSelectionToggle);St(n,{title:"Tags",icon:Ea,children:(S,h)=>{var I=ts();nt(I,5,s,_=>_.tag_id,(_,T)=>{var p=Zr(),g=f(p);const C=E(()=>l().has(a(T).tag_id));ta(g,{get name(){return a(T).tag_id},get isChecked(){return a(C)},get label(){return a(T).name},onCheckedChange:()=>a($)(a(T).tag_id)}),c(p),o(_,p)},_=>{var T=es();o(_,T)}),c(I),o(S,I)}}),J(),r()}function rs(){const n=Ze({width:200,height:200});return{sampleSize:n,updateWidth:t=>{n.set({width:t,height:t})}}}const Wt=async({dataset_id:n,filtered_labels:e,dimensions:t})=>{const r={data:[],error:void 0};try{const s=await Ye.GET("/api/annotations/count",{params:{query:{dataset_id:n,...e&&{filtered_labels:e},...(t==null?void 0:t.min_width)&&{min_width:t.min_width},...(t==null?void 0:t.max_width)&&{max_width:t.max_width},...(t==null?void 0:t.min_height)&&{min_height:t.min_height},...(t==null?void 0:t.max_height)&&{max_height:t.max_height}}}});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No annotation counts found");r.data=s.data.map(l=>({label_name:l.label_name,total_count:l.total_count,current_count:l.current_count}))}catch(s){r.error="Error loading annotation counts: "+String(s)}return r},ss=async()=>{const n={data:[],error:void 0};try{const e=await Ye.GET("/api/annotation_labels");e.data&&(n.data=e.data)}catch(e){n.error="Error loading annotation labels: "+String(e)}return n},ns=async({dataset_id:n,annotation_labels:e})=>{const t={data:void 0,error:void 0};try{const r=await Ye.GET("/api/samples/dimensions",{params:{query:{dataset_id:n,annotation_labels:e}}});if(r.error)throw new Error(JSON.stringify(r.error,null,2));if(!r.data)throw new Error("No dimension bounds data");t.data=r.data}catch(r){t.error="Error loading dimension bounds: "+String(r)}return t},Ht=(n,e)=>n.map(t=>({...t,selected:e.includes(t.label_name)})),Qt=n=>e=>e.includes(n)?e.filter(t=>t!==n):[...e,n],os=async({params:{dataset_id:n}})=>{const{data:e,error:t}=await Pa(n);if(t||!e)throw Ta(307,$t.toHome());const r=Ze({min_width:0,max_width:0,min_height:0,max_height:0}),{selectedAnnotationFilterIds:s}=Xt(),l=Array.from(dt(s)),i=Ze([]),d=Ze(l),m=Ze([]),$=Ze(void 0),S=p=>{$.set(p)},[h]=await Promise.all([ss().then(p=>{const g=p.data.reduce((v,B)=>({...v,[B.annotation_label_name]:B.annotation_label_id}),{}),C=Object.entries(g).filter(([,v])=>l.includes(v)).map(([v])=>v);return i.set(C),g}),ns({dataset_id:n}).then(({data:p})=>{p&&r.set(p)}),Wt({dataset_id:n}).then(({data:p})=>{if(p){const g=dt(i);m.set(Ht(p,g))}})]),I=async()=>{try{const p=dt(i),{data:g}=await Wt({dataset_id:n,filtered_labels:p.length>0?p:void 0,dimensions:dt(r)});g&&m.update(()=>Ht(g||[],p))}catch(p){$.set(`Failed to load annotations: ${String(p)}`)}},_=p=>{p&&(r.set(p),I())};return{datasetId:n,annotationFilters:m,toggleAnnotationFilterSelection:p=>{i.update(Qt(p));const g=h[p];s.update(C=>(C.has(g)?C.delete(g):C.add(g),C)),d.update(Qt(g)),I()},annotationFilterLabels:h,selectedAnnotationFilter:i,selectedAnnotationFilterIds:d,dimensions:Yt(r),updateDimensions:_,error:dt($),setError:S,sampleSize:rs()}},ks=Object.freeze(Object.defineProperty({__proto__:null,load:os},Symbol.toStringTag,{value:"Module"})),is=()=>{const n=Ze([]),e=Ze(null);return Ye.GET("/api/features").then(t=>{t.data&&n.set(t.data)}).catch(t=>{e.set(t)}),{error:e,featureFlags:Yt(n)}},ls=async({query_text:n="",model_id:e=""})=>{const t={data:[],error:void 0};try{const r=await Ye.GET("/api/text_embedding/embed_text",{params:{query:{query_text:n,model_id:e}}});if(r.error)throw new Error(JSON.stringify(r.error,null,2));if(!r.data)throw new Error("No data");t.data=r.data}catch(r){t.error="Error creating text embedding: "+String(r)}return t};var ds=b('<div class="space-y-2"><!> <!></div>'),cs=b('<div class="relative"><!> <!></div>'),us=b('<div class="flex h-full w-full space-x-4 px-4 pb-4"><div class="flex w-80 flex-col space-y-6 rounded-[1vw] bg-card py-4"><div class="px-4"><!></div> <div class="min-h-0 flex-1 space-y-2 overflow-y-auto px-4 dark:[color-scheme:dark]"><div><!> <!></div> <!></div></div> <div class="flex1 flex flex-grow flex-col space-y-4 rounded-[1vw] bg-card p-4"><div class="my-2 flex items-center space-x-4"><div class="flex-1"><!></div> <div class="w-4/12"><!></div></div> <!> <div class="flex min-h-0 flex-1"><!></div></div> <!></div>');function Es(n,e){K(e,!0);const[t,r]=vt(),s=()=>le(Ca,"$page",t),l=()=>le(g,"$textEmbedding",t),i=()=>le(Ce,"$featureFlags",t),d=()=>le(B,"$bonndedSampleSize",t);let m=s().params.dataset_id;const{dimensions:$,updateDimensions:S,annotationFilters:h,toggleAnnotationFilterSelection:I,sampleSize:_,setError:T,globalStorage:{setTextEmbedding:p,textEmbedding:g,setLastGridType:C}}=e.data;let v=Oe("samples");Sa(()=>{A(v,_e(s().url.pathname===$t.toAnnotations(m)?"annotations":"samples")),C(a(v))});const B=_.sampleSize;let M=Oe(_e(l()?l().queryText:""));async function k(){if(a(M).trim()!=="")try{return(await ls({query_text:a(M),model_id:void 0})).data}catch(P){T(P.message),console.error("Error during API call:",P)}}async function Te(P){if(P.key==="Enter"){const te=await k();te&&p({queryText:a(M),embedding:te})}}const{featureFlags:Ce}=is(),V=E(()=>i().some(P=>P==="embeddingSearchEnabled"));var z=us(),W=f(z),Me=f(W),De=f(Me);Za(De,{datasetId:m,get gridType(){return a(v)}}),c(Me);var qe=u(Me,2),xe=f(qe),Ve=f(xe);as(Ve,{dataset_id:m,get gridType(){return a(v)}});var ue=u(Ve,2);Yr(ue,{datasetId:m,get gridType(){return a(v)}}),c(xe);var Z=u(xe,2);St(Z,{title:"Filters",icon:or,children:(P,te)=>{var ne=ds(),R=f(ne);kr(R,{annotationFilters:h,onToggleAnnotationFilter:I});var D=u(R,2);{var be=Y=>{tr(Y,{dimensions:$,onChange:S})};Se(D,Y=>{$&&Y(be)})}c(ne),o(P,ne)}}),c(qe),c(W);var ge=u(W,2),ke=f(ge),$e=f(ke),Ee=f($e);{var We=P=>{var te=cs(),ne=f(te);nr(ne,{class:"absolute left-2 top-[50%] h-4 w-4 translate-y-[-50%] text-muted-foreground"});var R=u(ne,2);sa(R,{placeholder:"Search",class:"pl-8",onkeydown:Te,get value(){return a(M)},set value(D){A(M,_e(D))}}),c(te),o(P,te)};Se(Ee,P=>{a(v)==="samples"&&a(V)&&P(We)})}c($e);var y=u($e,2),G=f(y);wr(G,{get width(){return d().width},get onChange(){return _.updateWidth}}),c(y),c(ke);var X=u(ke,2);Lt(X,{class:"mb-4 bg-border-hard"});var he=u(X,2),L=f(he);ya(L,e,"default",{},null),c(he),c(ge);var ee=u(ge,2);br(ee,{}),c(z),o(n,z),J(),r()}export{Es as component,ks as universal};
